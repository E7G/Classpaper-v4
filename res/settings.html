<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassPaper è®¾ç½®</title>
    <script src="config/config.js"></script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        :root {
            /* Fluent Design Colors - Light Theme */
            --primary-color: #0078d4;
            --secondary-color: #106ebe;
            --success-color: #107c10;
            --danger-color: #d13438;
            --text-color: #323130;
            --bg-color: #faf9f8;
            --card-bg: #ffffff;
            --border-color: #edebe9;
            --hover-color: #f3f2f1;
            --accent-color: #0078d4;
            --subtle-border: #e1dfdd;
            --focus-color: #0078d4;
            --shadow-light: 0 1.6px 3.6px 0 rgba(0, 0, 0, 0.132), 0 0.3px 0.9px 0 rgba(0, 0, 0, 0.108);
            --shadow-medium: 0 3.2px 7.2px 0 rgba(0, 0, 0, 0.132), 0 0.6px 1.8px 0 rgba(0, 0, 0, 0.108);
            --shadow-heavy: 0 6.4px 14.4px 0 rgba(0, 0, 0, 0.132), 0 1.2px 3.6px 0 rgba(0, 0, 0, 0.108);
            --blur-bg: rgba(255, 255, 255, 0.85);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                /* Fluent Design Colors - Dark Theme */
                --primary-color: #0078d4;
                --secondary-color: #106ebe;
                --success-color: #107c10;
                --danger-color: #d13438;
                --text-color: #faf9f8;
                --bg-color: #201f1e;
                --card-bg: #323130;
                --border-color: #484644;
                --hover-color: #3b3a39;
                --accent-color: #0078d4;
                --subtle-border: #484644;
                --focus-color: #2899f5;
                --shadow-light: 0 1.6px 3.6px 0 rgba(0, 0, 0, 0.26), 0 0.3px 0.9px 0 rgba(0, 0, 0, 0.22);
                --shadow-medium: 0 3.2px 7.2px 0 rgba(0, 0, 0, 0.26), 0 0.6px 1.8px 0 rgba(0, 0, 0, 0.22);
                --shadow-heavy: 0 6.4px 14.4px 0 rgba(0, 0, 0, 0.26), 0 1.2px 3.6px 0 rgba(0, 0, 0, 0.22);
                --blur-bg: rgba(50, 49, 48, 0.85);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, -apple-system, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            padding: 24px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 0;
            border-radius: 8px;
            box-shadow: var(--shadow-medium);
            backdrop-filter: blur(10px);
            border: 1px solid var(--subtle-border);
            overflow: hidden;
        }

        h1,
        h2,
        h3,
        p {

            color: var(--text-color);
            margin-bottom: 16px;
            font-weight: 600;
        }

        h1 {
            text-align: center;
            font-size: 32px;
            margin-bottom: 24px;
            font-weight: 300;
            letter-spacing: -0.5px;
        }

        h2 {
            font-size: 20px;
            font-weight: 600;
            margin-top: 24px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        h3 {
            font-size: 16px;
            margin-top: 16px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-section {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            margin-bottom: 24px;
            box-shadow: var(--shadow-light);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.23, 1);
        }

        .form-section:hover {
            box-shadow: var(--shadow-medium);
            transform: translateY(-1px);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .settings-grid-full {
            grid-column: 1 / -1;
        }

        .tab-content {
            padding: 32px;
        }

        .tab-content h1 {
            margin-top: 0;
            margin-bottom: 32px;
            font-size: 28px;
            font-weight: 300;
        }

        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .tab-content {
                padding: 16px;
            }
        }

        .form-section-title {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-section-title i {
            margin-right: 8px;
            color: var(--primary-color);
        }

        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-color);
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: 400;
        }

        .checkbox-label input[type="checkbox"],
        .checkbox-label input[type="radio"] {
            margin-right: 8px;
            accent-color: var(--primary-color);
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        input[type="time"],
        input[type="datetime-local"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
            background: var(--card-bg);
            color: var(--text-color);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.23, 1);
        }

        input:focus {
            outline: none;
            border-color: var(--focus-color);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3);
        }

        input:hover:not(:focus) {
            border-color: var(--subtle-border);
        }

        .help-text {
            font-size: 12px;
            color: var(--secondary-color);
            margin-top: 4px;
            line-height: 1.4;
        }

        .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        button {
            padding: 6px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
            transition: all 0.1s cubic-bezier(0.4, 0, 0.23, 1);
            min-height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        button.primary {
            background-color: var(--primary-color);
            color: #ffffff;
        }

        button.primary:hover {
            background-color: #106ebe;
        }

        button.secondary {
            background-color: var(--hover-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        button.secondary:hover {
            background-color: var(--border-color);
        }

        button.add {
            background-color: var(--success-color);
            color: #ffffff;
        }

        button.add:hover {
            background-color: #0e700e;
        }

        button.delete {
            background-color: var(--danger-color);
            color: #ffffff;
            padding: 4px 12px;
            font-size: 12px;
            min-height: 28px;
        }

        button.delete:hover {
            background-color: #a72a2f;
        }

        button:hover {
            box-shadow: var(--shadow-light);
        }

        button:active {
            transform: scale(0.98);
        }

        button:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3);
        }

        .tab-container {
            margin-bottom: 24px;
        }

        .tab-buttons {
            display: flex;
            gap: 0;
            margin-bottom: 24px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }

        .tab-button {
            flex: 1;
            padding: 8px 16px;
            border: none;
            cursor: pointer;
            background-color: transparent;
            color: var(--text-color);
            font-weight: 600;
            font-size: 14px;
            font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.23, 1);
            border-right: 1px solid var(--border-color);
            position: relative;
        }

        .tab-button:last-child {
            border-right: none;
        }

        .tab-button.active {
            background-color: var(--primary-color);
            color: #ffffff;
        }

        .tab-button:hover:not(.active) {
            background-color: var(--hover-color);
        }

        .tab-button:focus {
            outline: none;
            z-index: 1;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.2s cubic-bezier(0.4, 0, 0.23, 1);
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(4px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 20px;
            background: var(--card-bg);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-light);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th,
        td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        th {
            background-color: var(--hover-color);
            font-weight: 600;
            color: var(--text-color);
            border-bottom: 2px solid var(--border-color);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: var(--hover-color);
            transition: background-color 0.1s ease;
        }

        .event-list,
        .wallpaper-list {
            margin-bottom: 20px;
        }

        .event-item,
        .wallpaper-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px 16px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.23, 1);
            box-shadow: var(--shadow-light);
        }

        .event-item:hover,
        .wallpaper-item:hover {
            box-shadow: var(--shadow-medium);
            background-color: var(--hover-color);
            transform: translateY(-1px);
        }

        .notice-editor {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
            resize: vertical;
            background: var(--card-bg);
            color: var(--text-color);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.23, 1);
        }

        .notice-editor:focus {
            outline: none;
            border-color: var(--focus-color);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3);
        }

        .preview-box {
            margin-top: 20px;
            padding: 16px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--hover-color);
            box-shadow: var(--shadow-light);
        }

        .status {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: 12px 20px;
            border-radius: 8px;
            display: none;
            animation: slideIn 0.2s cubic-bezier(0.4, 0, 0.23, 1);
            z-index: 1000;
            box-shadow: var(--shadow-heavy);
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 400px;
            word-wrap: break-word;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.23, 1);
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px) scale(0.9);
                opacity: 0;
            }

            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .status.success {
            background: rgba(16, 124, 16, 0.9);
            color: #ffffff;
            display: block;
            border-left: 4px solid #0e700e;
        }

        .status.error {
            background: rgba(209, 52, 56, 0.9);
            color: #ffffff;
            display: block;
            border-left: 4px solid #a72a2f;
        }

        .wallpaper-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px 16px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.23, 1);
            box-shadow: var(--shadow-light);
        }

        .wallpaper-item:hover {
            background: var(--hover-color);
            box-shadow: var(--shadow-medium);
            transform: translateY(-1px);
        }

        .wallpaper-thumb {
            width: 48px;
            height: 32px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: var(--border-color);
        }

        .wallpaper-item input[type="text"] {
            flex: 1;
            min-width: 180px;
            max-width: 400px;
            padding: 6px 8px;
            font-size: 14px;
        }

        .wallpaper-item button.delete {
            background: var(--danger-color);
            color: #ffffff;
            border: none;
            border-radius: 4px;
            padding: 4px 12px;
            font-size: 12px;
        }

        /* Officeé£æ ¼è¡¨æ ¼æ ·å¼ */
        #schedule .table-container {
            position: relative;
            touch-action: pan-y pinch-zoom;
        }

        .schedule-cell {
            position: relative;
            min-height: 40px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .schedule-cell:hover {
            background-color: rgba(0, 120, 212, 0.1);
        }

        .schedule-cell.selected {
            background-color: rgba(0, 120, 212, 0.2);
            border: 1px solid var(--primary-color);
        }

        .schedule-cell.editing {
            padding: 0;
            background-color: #ffffff;
        }

        .schedule-cell input {
            width: 100%;
            height: 100%;
            border: none;
            padding: 8px;
            font-size: 14px;
            background: transparent;
            outline: none;
        }

        .schedule-cell input:focus {
            box-shadow: 0 0 0 2px var(--primary-color);
        }

        /* è§¦å±ä¼˜åŒ– */
        @media (pointer: coarse) {
            .schedule-cell {
                min-height: 48px;
                padding: 12px 8px;
            }
            
            .table-toolbar button {
                padding: 12px 16px;
                font-size: 16px;
            }
        }

        /* æ‹–æ‹½æ ·å¼ */
        .drag-over {
            background-color: rgba(0, 120, 212, 0.3) !important;
            border: 2px dashed var(--primary-color);
        }

        /* æ‰¹é‡é€‰æ‹©æ ·å¼ */
        .range-selected {
            background-color: rgba(0, 120, 212, 0.15);
        }

        /* å·¥å…·æ æ ·å¼ */
        .table-toolbar {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            padding: 8px;
            background: var(--hover-color);
            border-radius: 4px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            gap: 4px;
            align-items: center;
            border-right: 1px solid var(--border-color);
            padding-right: 12px;
        }

        .toolbar-group:last-child {
            border-right: none;
            padding-right: 0;
        }

        .table-toolbar button {
            padding: 6px 10px;
            font-size: 12px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .table-toolbar button:hover {
            background: var(--hover-color);
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }

        .table-toolbar button:active {
            transform: scale(0.95) translateY(0);
        }

        /* Fluent Design èœå•æ ·å¼ */
        .context-menu, .long-press-menu {
            position: fixed;
            background: var(--blur-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--subtle-border);
            border-radius: 8px;
            box-shadow: var(--shadow-heavy);
            z-index: 1002;
            display: none;
            min-width: 200px;
            font-size: 14px;
            max-height: 80vh;
            overflow: hidden;
            animation: fluent-menu-show 0.15s cubic-bezier(0.1, 0.9, 0.2, 1) forwards;
            transform-origin: top left;
            contain: layout style paint;
        }

        @keyframes fluent-menu-show {
            from {
                opacity: 0;
                transform: scale(0.96) translateY(-8px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .context-menu-item {
            padding: 10px 16px;
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.1, 0.9, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: var(--text-color);
            font-weight: 400;
            position: relative;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            contain: layout style paint;
        }

        .context-menu-item:hover {
            background: var(--hover-color);
            color: var(--primary-color);
        }

        .context-menu-item:active {
            background: var(--primary-color);
            color: #ffffff;
            transform: scale(0.98);
        }

        .context-menu-separator {
            height: 1px;
            background: var(--border-color);
            margin: 4px 8px;
        }

        /* åˆ†çº§èœå•æ ·å¼ - ä¿®å¤å­èœå•å±•å¼€é—®é¢˜ */
        .context-menu-item.has-submenu {
            position: relative;
        }

        .context-menu-item.has-submenu::after {
            content: 'â€º';
            font-size: 16px;
            margin-left: 8px;
            transition: transform 0.2s ease;
            opacity: 0.7;
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
        }

        .context-menu-item.has-submenu:hover::after {
            transform: translateY(-50%) translateX(2px);
            opacity: 1;
        }

        .submenu {
            position: absolute;
            left: 100%;
            top: -4px;
            margin-left: 4px;
            background: var(--card-bg) !important;
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--border-color) !important;
            border-radius: 8px;
            box-shadow: var(--shadow-heavy) !important;
            min-width: 180px;
            display: none !important;
            z-index: 10001 !important;
            animation: fluent-submenu-show 0.15s cubic-bezier(0.1, 0.9, 0.2, 1) forwards;
            transform-origin: left top;
            contain: layout style paint;
        }

        @keyframes fluent-submenu-show {
            from {
                opacity: 0;
                transform: scale(0.96) translateX(-8px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateX(0);
            }
        }

        .context-menu-item.has-submenu:hover > .submenu {
            display: block !important;
        }
        
        .context-menu-item.has-submenu.active > .submenu {
            display: block !important;
        }
        
        .context-menu-item.active {
            background: var(--hover-color) !important;
            color: var(--primary-color) !important;
        }

        /* å­èœå•é¡¹æ ·å¼ */
        .submenu .context-menu-item {
            padding: 8px 12px !important;
            font-size: 13px !important;
            border-bottom: 1px solid var(--border-color) !important;
        }

        .submenu .context-menu-item:last-child {
            border-bottom: none !important;
        }

        .submenu .context-menu-item:hover {
            background: var(--hover-color) !important;
            color: var(--primary-color) !important;
        }

        /* èœå•å›¾æ ‡å’Œå¿«æ·é”® */
        .menu-icon {
            margin-right: 12px;
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            opacity: 0.8;
        }

        .menu-shortcut {
            font-size: 12px;
            color: var(--text-color);
            opacity: 0.6;
            margin-left: 16px;
            font-weight: 400;
        }

        /* èœå•è¾¹ç•Œæ£€æµ‹ */
        .context-menu.flipped-x .submenu {
            left: auto;
            right: 100%;
            margin-left: 0;
            margin-right: 4px;
            transform-origin: right top;
        }

        .context-menu.flipped-x .context-menu-item.has-submenu::after {
            content: 'â€¹';
        }

        .context-menu.flipped-y .submenu {
            top: auto;
            bottom: -4px;
            transform-origin: left bottom;
        }

        /* å³é”®èœå•å“åº”å¼æ ·å¼ */
        @media (max-width: 768px) {
            .context-menu, .long-press-menu {
                min-width: 220px;
                max-width: 90vw;
                border-radius: 8px;
                box-shadow: var(--shadow-heavy);
            }
            
            .context-menu-item {
                padding: 12px 20px;
                font-size: 16px;
            }
            
            .submenu {
                position: static;
                margin: 0;
                margin-top: 4px;
                margin-left: 16px;
                box-shadow: var(--shadow-light);
                animation: fluent-menu-show 0.15s ease;
                display: none; /* ç¡®ä¿åˆå§‹çŠ¶æ€ä¸ºéšè— */
            }
            
            .context-menu-item:hover > .submenu,
            .context-menu-item.active > .submenu {
                display: block;
            }
            
            .context-menu-item.has-submenu::after {
                content: 'â–¼';
                font-size: 12px;
                transition: transform 0.2s ease;
            }
            
            .context-menu-item.active.has-submenu::after {
                transform: rotate(180deg);
            }
        }

        /* è¡¨æ ¼é€‰æ‹©åŒºåŸŸ */
        .table-selection {
            position: absolute;
            background: rgba(0, 120, 212, 0.1);
            border: 1px solid var(--primary-color);
            pointer-events: none;
            z-index: 1000;
        }

        /* è°ƒæ•´æ‰‹æŸ„ */
        .resize-handle {
            position: absolute;
            width: 3px;
            height: 100%;
            right: 0;
            top: 0;
            cursor: col-resize;
            background: var(--primary-color);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .resize-handle:hover {
            opacity: 1;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.23, 1);
            min-height: 28px;
        }

        .wallpaper-item button.delete:hover {
            background: #a72a2f;
            box-shadow: var(--shadow-light);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: 16px;
            }
            
            .container {
                padding: 16px;
            }
            
            .status {
                top: 16px;
                right: 16px;
                left: 16px;
                max-width: none;
                font-size: 13px;
                padding: 10px 16px;
            }

            .tab-buttons {
                flex-direction: column;
                border-radius: 6px;
            }

            .tab-button {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }

            .tab-button:last-child {
                border-bottom: none;
            }

            .event-item,
            .wallpaper-item {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .button-group {
                flex-direction: column;
                gap: 8px;
            }

            .table-toolbar {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .toolbar-group {
                flex-direction: row;
                justify-content: center;
                flex-wrap: wrap;
                border-right: none;
                padding-right: 0;
                gap: 4px;
            }

            .table-toolbar button {
                flex: 1;
                min-width: 60px;
                font-size: 11px;
                padding: 5px 8px;
            }

            button {
                width: 100%;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        #schedule .form-section {
            margin-bottom: 24px;
            box-shadow: var(--shadow-light);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            padding: 24px;
        }

        #schedule .form-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 16px;
            border-left: 3px solid var(--primary-color);
            padding-left: 12px;
        }

        #schedule .table-container {
            border-radius: 6px;
            overflow: auto;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-light);
            position: relative;
            touch-action: pan-y pinch-zoom;
        }

        #schedule table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        #schedule th,
        #schedule td {
            padding: 8px 12px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        #schedule th {
            background: var(--hover-color);
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }

        #schedule tr:last-child td {
            border-bottom: none;
        }

        #schedule tr:hover {
            background: var(--hover-color);
            transition: background-color 0.1s ease;
        }

        /* Officeé£æ ¼è¡¨æ ¼ç¼–è¾‘åŠŸèƒ½ */
        .schedule-cell {
            position: relative;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .schedule-cell:hover {
            background: rgba(0, 120, 212, 0.1);
        }

        .schedule-cell.selected {
            background: rgba(0, 120, 212, 0.2);
            outline: 2px solid var(--primary-color);
            outline-offset: -2px;
        }

        .schedule-cell.editing {
            padding: 0;
            position: relative;
        }

        .schedule-cell input {
            width: 100%;
            height: 100%;
            border: none;
            background: var(--card-bg);
            color: var(--text-color);
            font-size: inherit;
            font-family: inherit;
            padding: 8px;
            text-align: center;
            outline: none;
            box-shadow: inset 0 0 0 2px var(--primary-color);
        }

        .schedule-cell input:focus {
            box-shadow: inset 0 0 0 2px var(--primary-color), 0 0 0 1px rgba(0, 120, 212, 0.3);
        }

        /* è§¦å±ä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            .schedule-cell {
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .schedule-cell:active {
                background: rgba(0, 120, 212, 0.15);
                transform: scale(0.98);
                transition: all 0.1s ease;
            }
        }

        /* æ‹–æ”¾æ ·å¼ */
        .schedule-cell.drag-over {
            background: rgba(0, 120, 212, 0.3);
            border: 2px dashed var(--primary-color);
        }

        /* æ‰¹é‡é€‰æ‹©æ ·å¼ */
        .schedule-cell.range-selected {
            background: rgba(0, 120, 212, 0.1);
        }

        /* å·¥å…·æ æ ·å¼ */
        .table-toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            padding: 8px;
            background: var(--hover-color);
            border-radius: 4px;
            align-items: center;
        }

        .table-toolbar button {
            padding: 4px 8px;
            font-size: 12px;
            min-height: 28px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .table-toolbar button:hover {
            background: var(--hover-color);
            border-color: var(--primary-color);
        }

        .table-toolbar button.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* ä¸Šä¸‹æ–‡èœå• - ä¿®å¤æ˜¾ç¤ºé—®é¢˜ */
        .context-menu {
            position: fixed !important;
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            box-shadow: var(--shadow-heavy) !important;
            z-index: 10000 !important;
            min-width: 200px !important;
            display: none !important;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .context-menu.show {
            display: block !important;
        }

        .context-menu-item {
            padding: 10px 16px !important;
            cursor: pointer !important;
            font-size: 14px !important;
            border-bottom: 1px solid var(--border-color) !important;
            color: var(--text-color) !important;
            transition: all 0.2s ease !important;
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
        }

        .context-menu-item:last-child {
            border-bottom: none !important;
        }

        .context-menu-item:hover {
            background: var(--hover-color) !important;
            color: var(--primary-color) !important;
        }

        .context-menu-item:active {
            background: var(--primary-color) !important;
            color: white !important;
        }

        /* è§¦å±é•¿æŒ‰èœå• */
        .long-press-menu {
            position: fixed;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow-heavy);
            z-index: 1001;
            display: none;
            min-width: 140px;
            padding: 4px 0;
        }

        .long-press-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .long-press-item:last-child {
            border-bottom: none;
        }

        .long-press-item:active {
            background: var(--hover-color);
        }

        .context-menu-separator {
            height: 1px;
            background: var(--border-color);
            margin: 4px 0;
        }

        /* è¡¨æ ¼é€‰æ‹©æ ·å¼ */
        .table-selection {
            position: absolute;
            background: rgba(0, 120, 212, 0.1);
            border: 1px solid var(--primary-color);
            pointer-events: none;
            z-index: 10;
        }

        /* æ‹–åŠ¨è°ƒæ•´å¤§å°æ‰‹æŸ„ */
        .resize-handle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--primary-color);
            cursor: nwse-resize;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .schedule-cell:hover .resize-handle {
            opacity: 1;
        }

        #schedule input[type="text"],
        #schedule input[type="time"] {
            width: 90px;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            font-size: 14px;
        }

        #schedule .add,
        #schedule .secondary {
            min-width: 90px;
            margin-right: 8px;
            font-size: 12px;
            padding: 4px 12px;
        }

        #schedule .form-group {
            margin-bottom: 16px;
        }

        #schedule .help-text {
            font-size: 12px;
            color: var(--secondary-color);
            line-height: 1.4;
        }

        #schedule .button-group {
            margin-top: 16px;
        }

        @media (max-width: 900px) {
            #schedule .form-section {
                padding: 16px;
            }

            #schedule input[type="text"],
            #schedule input[type="time"] {
                width: 70px;
                font-size: 12px;
            }
        }

        /* å¯ç¼–è¾‘å•å…ƒæ ¼æ ·å¼ */
        .schedule-cell {
            cursor: text;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            transition: background-color 0.2s ease;
        }

        .schedule-cell:hover {
            background-color: rgba(0, 120, 212, 0.1) !important;
        }

        .schedule-cell:focus {
            outline: 2px solid #0078d4;
            outline-offset: -2px;
            background-color: white !important;
        }

        .schedule-cell[contenteditable="true"]:focus {
            background-color: white !important;
            box-shadow: inset 0 0 0 1px #0078d4;
        }

        .edit-input {
            font-family: inherit;
            font-size: inherit;
            color: var(--text-color) !important;
            background: var(--card-bg) !important;
            border: 2px solid var(--primary-color) !important;
            outline: none;
            text-align: center;
            padding: 8px;
            margin: 0;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            display: block;
            border-radius: 4px;
        }

        .edit-input:focus {
            color: var(--text-color) !important;
            background: var(--card-bg) !important;
            border-color: var(--focus-color) !important;
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3) !important;
        }

        .schedule-cell.editing {
            padding: 0 !important;
            background: white !important;
            box-shadow: inset 0 0 0 2px #0078d4;
        }
    </style>
</head>

<body>
    <div class="container">
        <div style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; padding: 48px 32px; text-align: center; margin-bottom: 0;">
            <h1 style="margin: 0; font-size: 32px; font-weight: 300; letter-spacing: -0.5px;">ClassPaper è®¾ç½®</h1>
            <p style="margin: 8px 0 0 0; opacity: 0.9; font-size: 16px;">ä¸€çº¸ç´ ç¬ºç»˜æ˜¥ç§‹ï¼Œæ–¹å¯¸ä¹‹é—´å®¹ä¸‡è±¡ï¼› è¯¾è¡¨è½»å±•å¦‚ç”»å·ï¼Œå£çº¸æµè½¬ä¼¼æµå…‰ã€‚</p>
        </div>

        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('basic')">åŸºæœ¬è®¾ç½®</button>
                <button class="tab-button" onclick="switchTab('schedule')">è¯¾ç¨‹è¡¨</button>
                <button class="tab-button" onclick="switchTab('events')">äº‹ä»¶</button>
                <button class="tab-button" onclick="switchTab('wallpapers')">å£çº¸</button>
                <button class="tab-button" onclick="switchTab('notice')">å‘Šç¤ºç‰Œ</button>
            </div>
        </div>

        <div id="basic" class="tab-content active">
            <div class="settings-grid">
            <div class="form-section">
                <div class="form-section-title">
                    <h2>è¿›åº¦æ¡è®¾ç½®</h2>
                </div>
                <div class="form-group">
                    <label for="progress-description">è¿›åº¦æ¡è‡ªå®šä¹‰æè¿°</label>
                    <input type="text" id="progress-description" maxlength="30" placeholder="å¦‚ï¼šé«˜ä¸‰å‰©ä½™ã€è·ç¦»æ¯•ä¸šã€è·ç¦»é«˜è€ƒ...">
                    <div class="help-text">è®¾ç½®ä¸»ç•Œé¢è¿›åº¦æ¡ä¸‹æ–¹çš„è‡ªå®šä¹‰æè¿°æ–‡æœ¬ï¼Œæ”¯æŒä»»æ„å†…å®¹ã€‚</div>
                </div>
                <div class="form-group">
                    <label for="semester-begin">è¿›åº¦æ¡äº‹ä»¶å¼€å§‹æ—¶é—´</label>
                    <input type="date" id="semester-begin">
                    <div class="help-text">è®¾ç½®è¿›åº¦æ¡äº‹ä»¶çš„å¼€å§‹æ—¥æœŸ</div>
                </div>
                <div class="form-group">
                    <label for="semester-end">è¿›åº¦æ¡äº‹ä»¶ç»“æŸæ—¶é—´</label>
                    <input type="date" id="semester-end">
                    <div class="help-text">è®¾ç½®è¿›åº¦æ¡äº‹ä»¶çš„ç»“æŸæ—¥æœŸ</div>
                </div>
                <div class="form-group">
                    <label>ç™¾åˆ†æ¯”æ˜¾ç¤ºæ–¹å¼</label>
                    <label class="checkbox-label" style="margin-right: 18px;">
                        <input type="radio" name="progress-percent-mode" id="progress-percent-left" value="left"
                            checked>
                        æ˜¾ç¤ºå‰©ä½™ç™¾åˆ†æ¯”
                    </label>
                    <label class="checkbox-label">
                        <input type="radio" name="progress-percent-mode" id="progress-percent-passed" value="passed">
                        æ˜¾ç¤ºå·²è¿‡ç™¾åˆ†æ¯”
                    </label>
                    <div class="help-text">å¯åˆ‡æ¢è¿›åº¦æ¡ä¸‹æ–¹æ˜¾ç¤ºâ€œå‰©ä½™â€æˆ–â€œå·²è¿‡â€ç™¾åˆ†æ¯”ã€‚</div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-section-title">
                    <h2>å‘¨æ•°è®¾ç½®</h2>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="week-offset-enabled">
                        å¯ç”¨è‡ªå®šä¹‰å‘¨æ•°
                    </label>
                    <div class="help-text">å¼€å¯åå¯ä»¥è‡ªå®šä¹‰æ˜¾ç¤ºçš„å‘¨æ•°</div>
                </div>
                <div class="form-group">
                    <label for="week-offset">å‘¨æ•°åç§»å€¼</label>
                    <input type="number" id="week-offset" min="0" max="52">
                    <div class="help-text">å®é™…æ˜¾ç¤ºçš„å‘¨æ•° = æœ¬å¹´ç¬¬å‡ å‘¨ - åç§»å€¼ã€‚ä¾‹å¦‚ï¼šå¦‚æœç°åœ¨æ˜¯æœ¬å¹´ç¬¬9å‘¨ï¼Œåç§»å€¼ä¸º7ï¼Œåˆ™æ˜¾ç¤ºä¸ºç¬¬2å‘¨ã€‚</div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-section-title">
                    <h2>æç¤ºéŸ³è®¾ç½®</h2>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="notifications-enabled">
                        å¯ç”¨è¯¾å ‚æç¤ºéŸ³
                    </label>
                    <div class="help-text">å¼€å¯åä¼šåœ¨ä¸Šè¯¾æœŸé—´å®šæœŸæ’­æ”¾æç¤ºéŸ³</div>
                </div>
                <div class="form-group">
                    <label for="regular-interval">å¸¸è§„æç¤ºé—´éš”ï¼ˆåˆ†é’Ÿï¼‰</label>
                    <input type="number" id="regular-interval" min="1" max="30">
                    <div class="help-text">è®¾ç½®ä¸¤æ¬¡æç¤ºéŸ³ä¹‹é—´çš„æ—¶é—´é—´éš”</div>
                </div>
                <div class="form-group">
                    <label for="ending-time">ç»“æŸæç¤ºæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                    <input type="number" id="ending-time" min="1" max="30">
                    <div class="help-text">è®¾ç½®è¯¾ç¨‹ç»“æŸå‰å¤šå°‘åˆ†é’Ÿæ’­æ”¾ç»“æŸæç¤ºéŸ³</div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-section-title">
                    <h2>ç³»ç»Ÿè®¾ç½®</h2>
                </div>
        <div class="form-group">
                    <label for="url">å£çº¸é¡µé¢URL</label>
            <input type="text" id="url" placeholder="è¾“å…¥é¡µé¢URLæˆ–æœ¬åœ°æ–‡ä»¶è·¯å¾„">
                    <div class="help-text">å¯ä»¥æ˜¯ç½‘é¡µåœ°å€æˆ–æœ¬åœ°å£çº¸æ–‡ä»¶å¤¹è·¯å¾„</div>
                </div>
                <div class="form-group">
                    <label for="browser">æµè§ˆå™¨è·¯å¾„ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="browser" placeholder="è¾“å…¥Chromeæµè§ˆå™¨è·¯å¾„">
                    <div class="help-text">å¦‚æœç³»ç»Ÿæ— æ³•è‡ªåŠ¨æ‰¾åˆ°Chromeæµè§ˆå™¨ï¼Œè¯·æ‰‹åŠ¨æŒ‡å®šè·¯å¾„</div>
                </div>
                <!-- æ–°å¢è°ƒè¯•æŒ‰é’® -->
                <button class="secondary" onclick="openInBrowser()">åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è°ƒè¯•</button>
                </div>
            </div>
        </div>

        <div id="schedule" class="tab-content">
            <div class="settings-grid">
                <div class="form-section settings-grid-full">
                    <div class="form-section-title">
                        <h2>è¯¾ç¨‹æ—¶é—´å®‰æ’</h2>
                    </div>
                    <div style="display:flex;align-items:center;gap:18px;margin-bottom:10px;">
                        <button class="add" onclick="smartGuessTimeTable()">æ™ºèƒ½æ¨ç®—</button>
                        <span class="help-text">ä¸€é”®æ ¹æ®å·²å¡«æ—¶é—´æ™ºèƒ½è¡¥å…¨åç»­èŠ‚æ¬¡æ—¶é—´ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µæ‰‹åŠ¨å¾®è°ƒã€‚</span>
                    </div>
                    <div class="table-container">
                        <table id="timeTable">
                            <thead>
                                <tr>
                                    <th>èŠ‚æ¬¡</th>
                                    <th>ä¸Šè¯¾æ—¶é—´</th>
                                    <th>ä¸‹è¯¾æ—¶é—´</th>
                                    <th>ä¼‘æ¯æ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <button class="add" onclick="addTimeSlot()">æ·»åŠ æ—¶é—´æ®µ</button>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">
                        <h2>è¯¾è¡¨æ˜¾ç¤ºæ¨¡å¼</h2>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="radio" name="display-mode" id="display-mode-scroll" value="scroll">
                            æ»šåŠ¨æ¨¡å¼ï¼ˆå½“å‰è¯¾ç¨‹å±…ä¸­ï¼Œå‰åå¤©å¡«å……ç©ºç™½ï¼‰
                        </label>
                        <label class="checkbox-label">
                            <input type="radio" name="display-mode" id="display-mode-day" value="day">
                            ä¸€å¤©è¿›åº¦æ¨¡å¼ï¼ˆåªæ˜¾ç¤ºå½“å¤©å…¨éƒ¨è¯¾ç¨‹ï¼ŒæŒ‰æ—¶é—´é«˜äº®ï¼‰
                        </label>
                        <div class="help-text">é€‰æ‹©è¯¾è¡¨çš„æ˜¾ç¤ºæ–¹å¼ï¼Œæ»šåŠ¨æ¨¡å¼é€‚åˆå¤§å±ï¼Œè¿›åº¦æ¨¡å¼é€‚åˆç§»åŠ¨ç«¯æˆ–ç®€æ´éœ€æ±‚ã€‚</div>
                    </div>
                </div>

                <div class="form-section settings-grid-full">
                        <div class="form-section-title">
                            <h2>è¯¾ç¨‹å®‰æ’</h2>
                        </div>
                        <div class="form-group">
                            <label for="schedule-import">å¯¼å…¥è¯¾ç¨‹è¡¨</label>
                            <textarea id="schedule-import" class="notice-editor" style="min-height: 100px;" placeholder="ç²˜è´´è¯¾ç¨‹è¡¨æ–‡æœ¬ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
æ˜ŸæœŸ,1,2,3,4,5,6,7,8,9,10,11,
å‘¨ä¸€,å‡æ——,ç­ä¼š,ç‰©ç†,è‹±è¯­,æ•°å­¦,æ•°å­¦,ç”Ÿç‰©,åŒ–å­¦,è¯­æ–‡,æ™šä¿®,æ™šä¿®,
å‘¨äºŒ,è¯­æ–‡,è¯­æ–‡,æ•°å­¦,è‹±è¯­,ä½“è‚²,ç‰©ç†,ç”Ÿç‰©,åŒ–å­¦,è‡ªä¹ ,æ™šä¿®,æ™šä¿®,
..."></textarea>
                            <div class="help-text">æ”¯æŒCSVæ ¼å¼çš„è¯¾ç¨‹è¡¨æ–‡æœ¬å¯¼å…¥ï¼Œç¬¬ä¸€è¡Œä¸ºè¡¨å¤´ï¼Œä¹‹åæ¯è¡Œä¸ºä¸€å¤©çš„è¯¾ç¨‹å®‰æ’</div>
                            <button class="secondary" onclick="importSchedule()">å¯¼å…¥è¯¾ç¨‹è¡¨</button>
                        </div>
                        
                        <!-- Officeé£æ ¼å·¥å…·æ  -->
                        <div class="table-toolbar" id="tableToolbar">
                            <div class="toolbar-group">
                                <button onclick="addRow()" title="æ·»åŠ è¡Œ">â• è¡Œ</button>
                                <button onclick="addColumn()" title="æ·»åŠ åˆ—">â• åˆ—</button>
                                <button onclick="deleteRow()" title="åˆ é™¤è¡Œ">ğŸ—‘ï¸ åˆ è¡Œ</button>
                                <button onclick="deleteColumn()" title="åˆ é™¤åˆ—">ğŸ—‘ï¸ åˆ åˆ—</button>
                            </div>
                            <div class="toolbar-group">
                                <button onclick="copyCells()" title="å¤åˆ¶">ğŸ“‹ å¤åˆ¶</button>
                                <button onclick="pasteCells()" title="ç²˜è´´">ğŸ“‹ ç²˜è´´</button>
                                <button onclick="deleteSelected()" title="åˆ é™¤å†…å®¹">ğŸ—‘ï¸ åˆ é™¤</button>
                                <button onclick="clearCells()" title="æ¸…ç©ºå†…å®¹">ğŸ§¹ æ¸…ç©º</button>
                            </div>
                            <div class="toolbar-group">
                                <button onclick="mergeCells()" title="åˆå¹¶å•å…ƒæ ¼">ğŸ”— åˆå¹¶</button>
                                <button onclick="splitCell()" title="æ‹†åˆ†å•å…ƒæ ¼">âœ‚ï¸ æ‹†åˆ†</button>
                                <button onclick="fillSeries()" title="å¡«å……åºåˆ—">ğŸ“Š åºåˆ—</button>
                                <button onclick="autoFitColumns()" title="è‡ªåŠ¨è°ƒæ•´åˆ—å®½">ğŸ“ è‡ªé€‚åº”</button>
                            </div>
                            <div class="toolbar-group">
                                <button onclick="undoAction()" title="æ’¤é”€">â†©ï¸ æ’¤é”€</button>
                                <button onclick="redoAction()" title="é‡åš">â†ªï¸ é‡åš</button>
                                <button onclick="findAndReplace()" title="æŸ¥æ‰¾æ›¿æ¢">ğŸ” æŸ¥æ‰¾</button>
                            </div>
                            <div class="toolbar-group">
                                <button onclick="exportData()" title="å¯¼å‡ºCSV">ğŸ“¤ å¯¼å‡º</button>
                                <button onclick="importData()" title="å¯¼å…¥CSV">ğŸ“¥ å¯¼å…¥</button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table id="scheduleTable">
                                <thead>
                                    <tr>
                                        <th>æ˜ŸæœŸ/èŠ‚æ¬¡</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        
                </div>
            </div>
        </div>

        <div id="events" class="tab-content">
            <div class="settings-grid">
                <div class="form-section settings-grid-full">
                    <div class="form-section-title">
                        <h2>äº‹ä»¶åˆ—è¡¨</h2>
                    </div>
                    <div class="event-list" id="eventList">
                    </div>
                    <button class="add" onclick="addEvent()">æ·»åŠ äº‹ä»¶</button>
                </div>
            </div>
        </div>

        <div id="wallpapers" class="tab-content">
            <div class="settings-grid">
                <div class="form-section settings-grid-full">
                    <div class="form-section-title">
                        <h2>å£çº¸ç®¡ç†</h2>
                    </div>
                    <div class="wallpaper-list" id="wallpaperList" style="margin-bottom: 24px;">
                        <!-- åŠ¨æ€ç”Ÿæˆå£çº¸é¡¹ï¼Œæ¯é¡¹å«ç¼©ç•¥å›¾ã€è·¯å¾„è¾“å…¥ã€åˆ é™¤æŒ‰é’® -->
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: end;">
                        <div class="form-group" style="margin: 0;">
                            <label for="wallpaper-interval">åˆ‡æ¢é—´éš”ï¼ˆç§’ï¼‰</label>
                            <input type="number" id="wallpaper-interval" min="5" max="3600" step="1" value="30"
                                style="width: 120px;">
                            <div class="help-text">å£çº¸è‡ªåŠ¨åˆ‡æ¢çš„æ—¶é—´é—´éš”ï¼Œå»ºè®®ä¸å°äº5ç§’</div>
                        </div>
                        <div class="button-group" style="justify-content: flex-start; gap: 16px; margin: 0;">
                            <button class="secondary" onclick="scanWallpapers()">æ‰«æå£çº¸æ–‡ä»¶å¤¹</button>
                            <button class="add" onclick="addWallpaper()">æ·»åŠ å£çº¸</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="notice" class="tab-content">
            <div class="settings-grid">
                <div class="form-section settings-grid-full">
                    <div class="form-section-title">
                        <h2>å‘Šç¤ºå†…å®¹</h2>
                    </div>
                    <div class="form-group">
                        <label for="notice-content">å‘Šç¤ºå†…å®¹ï¼ˆæ”¯æŒHTMLï¼‰</label>
                        <textarea id="notice-content" class="notice-editor" placeholder="åœ¨è¿™é‡Œè¾“å…¥å‘Šç¤ºå†…å®¹ï¼Œæ”¯æŒHTMLæ ‡ç­¾"
                            oninput="updatePreview()"></textarea>
                    </div>
                    <div class="preview-box">
                        <h3>é¢„è§ˆ</h3>
                        <div id="notice-preview"></div>
                    </div>
                </div>
            </div>
        </div>
<!-- 
        <div id="status" class="status"></div> -->

        <style>
        /* Fluent Design Dialog Styles */
        .fluent-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.32);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fluentFadeIn 0.2s ease-out;
        }

        .fluent-dialog {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow-heavy);
            min-width: 400px;
            max-width: 500px;
            margin: 16px;
            overflow: hidden;
            animation: fluentSlideIn 0.3s ease-out;
        }

        .fluent-dialog-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .fluent-dialog-title {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
        }

        .fluent-dialog-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-color);
            opacity: 0.6;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
        }

        .fluent-dialog-close:hover {
            opacity: 1;
        }

        .fluent-dialog-content {
            padding: 24px;
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .fluent-dialog-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .fluent-dialog-message h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-color);
        }

        .fluent-dialog-message p {
            margin: 0;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
            line-height: 1.5;
        }

        .fluent-dialog-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .fluent-button {
            padding: 6px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 32px;
        }

        .fluent-button-primary {
            background: var(--primary-color);
            color: #ffffff;
        }

        .fluent-button-primary:hover {
            background: #106ebe;
        }

        .fluent-button-secondary {
            background: var(--hover-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .fluent-button-secondary:hover {
            background: var(--border-color);
        }

        .fluent-button-danger {
            background: var(--danger-color);
            color: #ffffff;
        }

        .fluent-button-danger:hover {
            background: #a72a2f;
        }

        @keyframes fluentFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fluentSlideIn {
            from { 
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @media (max-width: 768px) {
            .fluent-dialog {
                min-width: 300px;
                margin: 16px;
            }
            
            .fluent-dialog-content {
                flex-direction: column;
                text-align: center;
                gap: 12px;
            }
            
            .fluent-dialog-icon {
                margin: 0 auto;
            }
        }
        </style>

        <div class="button-group">
            <button class="secondary" onclick="showResetDialog()">é‡ç½®</button>
            <button class="primary" onclick="handleSave()">ä¿å­˜</button>
        </div>
    </div>

    <script>
        let currentConfig = null;

        function switchTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            // å–æ¶ˆæ‰€æœ‰æ ‡ç­¾æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µå†…å®¹
            document.getElementById(tabId).classList.add('active');
            // æ¿€æ´»å¯¹åº”çš„æ ‡ç­¾æŒ‰é’®
            document.querySelector(`.tab-button[onclick="switchTab('${tabId}')"]`).classList.add('active');
        }

        // æ£€æŸ¥å‡½æ•°æ˜¯å¦å·²ç»‘å®š
        function waitForBinding(funcName) {
            return new Promise((resolve) => {
                const check = () => {
                    if (typeof window[funcName] === 'function') {
                        resolve();
                    } else {
                        setTimeout(check, 100);
                    }
                };
                check();
            });
        }

        // æ‰«æå£çº¸æ–‡ä»¶å¤¹
        async function scanWallpapers() {
            try {
                await waitForBinding('scanWallpaperDir');

                if (typeof window.scanWallpaperDir !== 'function') {
                    throw new Error('scanWallpaperDir å‡½æ•°æœªå®šä¹‰');
                }

                const wallpapers = await window.scanWallpaperDir();
                if (Array.isArray(wallpapers)) {
                    // è·å–ç°æœ‰å£çº¸åˆ—è¡¨
                    const container = document.getElementById('wallpaperList');
                    const existingItems = Array.from(container.children);

                    // è§„èŒƒåŒ–è·¯å¾„ï¼ˆç§»é™¤å‰å¯¼./ï¼Œç»Ÿä¸€åˆ†éš”ç¬¦ï¼Œç¡®ä¿ç›¸å¯¹äºindex.htmlï¼‰
                    const normalizePath = (path) => {
                        // ç§»é™¤å‰å¯¼./å’Œres/
                        return path.replace(/^\.\//, '')
                            .replace(/^res\//, '')
                            .replace(/\\/g, '/');
                    };

                    const existingPaths = new Set(
                        existingItems.map(item =>
                            normalizePath(item.querySelector('input').value)
                        )
                    );

                    // åªæ·»åŠ ä¸å­˜åœ¨çš„å£çº¸
                    let addedCount = 0;
                    wallpapers.forEach(wallpaper => {
                        const normalizedPath = normalizePath(wallpaper);
                        if (!existingPaths.has(normalizedPath)) {
                            container.innerHTML += `
                                <div class="wallpaper-item">
                                    <input type="text" placeholder="å£çº¸è·¯å¾„" value="${wallpaper}">
                                    <button class="delete" onclick="deleteWallpaper(${container.children.length})">åˆ é™¤</button>
                                </div>
                            `;
                            addedCount++;
                        }
                    });

                    if (addedCount > 0) {
                        showStatus(`å·²æ·»åŠ  ${addedCount} ä¸ªæ–°å£çº¸`, 'success');
                    } else {
                        showStatus('æ²¡æœ‰å‘ç°æ–°çš„å£çº¸', 'success');
                    }
                } else {
                    throw new Error('æ— æ•ˆçš„å£çº¸åˆ—è¡¨æ•°æ®');
                }
            } catch (e) {
                console.error('æ‰«æå£çº¸æ–‡ä»¶å¤¹å¤±è´¥:', e);
                showStatus('æ‰«æå£çº¸æ–‡ä»¶å¤¹å¤±è´¥: ' + e, 'error');
            }
        }

        // åˆå§‹åŒ–è¯¾ç¨‹è¡¨
        function initScheduleTable(config) {
            const table = document.getElementById('scheduleTable');
            const thead = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');

            // æ¸…ç©ºç°æœ‰å†…å®¹
            thead.innerHTML = '<th>æ˜ŸæœŸ/èŠ‚æ¬¡</th>';
            tbody.innerHTML = '';

            // æ·»åŠ è¡¨å¤´
            config.lessons.headers.slice(1).forEach(header => {
                thead.innerHTML += `<th>${header}</th>`;
            });

            // æ·»åŠ è¡¨æ ¼å†…å®¹
            config.lessons.schedule.forEach(day => {
                const row = document.createElement('tr');
                const dayCell = document.createElement('td');
                dayCell.className = 'schedule-day';
                dayCell.textContent = day.day;
                dayCell.style.fontWeight = 'bold';
                row.appendChild(dayCell);
                
                day.classes.forEach(lesson => {
                    const cell = document.createElement('td');
                    cell.className = 'schedule-cell';
                    cell.textContent = lesson;
                    row.appendChild(cell);
                });
                tbody.appendChild(row);
            });
        }

        // åˆå§‹åŒ–äº‹ä»¶åˆ—è¡¨
        function initEventList(events) {
            const container = document.getElementById('eventList');
            container.innerHTML = '';
            events.forEach((event, index) => {
                container.innerHTML += `
                    <div class="event-item">
                        <input type="text" placeholder="äº‹ä»¶åç§°" value="${event.name}">
                        <input type="datetime-local" value="${event.date.split('T')[0]}T${event.date.split('T')[1].split('.')[0]}">
                        <button class="delete" onclick="deleteEvent(${index})">åˆ é™¤</button>
                    </div>
                `;
            });
        }

        // åˆå§‹åŒ–å£çº¸åˆ—è¡¨
        function initWallpaperList(wallpapers) {
            const container = document.getElementById('wallpaperList');
            container.innerHTML = '';
            wallpapers.forEach((wallpaper, index) => {
                // æ”¯æŒæœ¬åœ°ç›¸å¯¹è·¯å¾„ç¼©ç•¥å›¾
                let thumbSrc = wallpaper;
                if (!/^https?:\/\//.test(wallpaper) && !/^data:/.test(wallpaper)) {
                    thumbSrc = wallpaper.replace(/^\.\//, '').replace(/^res\//, '');
                }
                container.innerHTML += `
                    <div class="wallpaper-item">
                        <img class="wallpaper-thumb" src="${thumbSrc}" alt="é¢„è§ˆ" onerror="this.src='icon/icon.png'">
                        <input type="text" placeholder="å£çº¸è·¯å¾„" value="${wallpaper}">
                        <button class="delete" onclick="deleteWallpaper(${index})">åˆ é™¤</button>
                    </div>
                `;
            });
        }

        // æ·»åŠ äº‹ä»¶
        function addEvent() {
            const container = document.getElementById('eventList');
            const now = new Date().toISOString().slice(0, 16);
            container.innerHTML += `
                <div class="event-item">
                    <input type="text" placeholder="äº‹ä»¶åç§°">
                    <input type="datetime-local" value="${now}">
                    <button class="delete" onclick="deleteEvent(${container.children.length})">åˆ é™¤</button>
                </div>
            `;
        }

        // åˆ é™¤äº‹ä»¶
        function deleteEvent(index) {
            const container = document.getElementById('eventList');
            container.children[index].remove();
        }

        // æ·»åŠ å£çº¸
        function addWallpaper() {
            const container = document.getElementById('wallpaperList');
            container.innerHTML += `
                <div class="wallpaper-item">
                    <input type="text" placeholder="ç›¸å¯¹äºindex.htmlçš„å£çº¸è·¯å¾„ï¼Œä¾‹å¦‚ï¼šwallpaper/bg.jpg">
                    <button class="delete" onclick="deleteWallpaper(${container.children.length})">åˆ é™¤</button>
                </div>
            `;
        }

        // åˆ é™¤å£çº¸
        function deleteWallpaper(index) {
            const container = document.getElementById('wallpaperList');
            container.children[index].remove();
        }

        // åˆå§‹åŒ–å‘Šç¤ºå†…å®¹
        function initNotice(sth) {
            document.getElementById('notice-content').value = sth || '';
            updatePreview();
        }

        // æ›´æ–°é¢„è§ˆï¼ˆä¼˜åŒ–ï¼šæ”¯æŒå¤šè¡Œæ¢è¡Œæ˜¾ç¤ºï¼‰
        function updatePreview() {
            const content = document.getElementById('notice-content').value;
            // æ”¯æŒå¤šè¡Œæ¢è¡Œæ˜¾ç¤º
            document.getElementById('notice-preview').innerHTML = content.replace(/\n/g, '<br>');
        }

        // æ”¶é›†è¯¾ç¨‹è¡¨æ•°æ®
        function getScheduleData() {
            const tbody = document.getElementById('scheduleTable').querySelector('tbody');
            const schedule = [];

            Array.from(tbody.children).forEach(row => {
                const day = row.cells[0].textContent.trim();
                const classes = Array.from(row.cells).slice(1).map(cell => cell.textContent.trim());
                schedule.push({ day, classes });
            });

            return schedule;
        }

        // æ”¶é›†äº‹ä»¶æ•°æ®
        function getEventData() {
            const container = document.getElementById('eventList');
            const events = [];
            Array.from(container.children).forEach(item => {
                const inputs = item.querySelectorAll('input');
                events.push({
                    name: inputs[0].value,
                    date: inputs[1].value + ':00'
                });
            });
            return events;
        }

        // æ”¶é›†å£çº¸æ•°æ®
        function getWallpaperData() {
            const container = document.getElementById('wallpaperList');
            return Array.from(container.children).map(item => item.querySelector('input').value);
        }

        // è·å–å‘Šç¤ºå†…å®¹
        function getNoticeData() {
            return document.getElementById('notice-content').value;
        }

        // æ·»åŠ æ—¶é—´æ®µ
        function addTimeSlot() {
            const tbody = document.getElementById('timeTable').querySelector('tbody');
            const newRow = document.createElement('tr');
            const period = tbody.children.length + 1;
            newRow.innerHTML = `
                <td>${period}</td>
                <td><input type="time" class="time-begin"></td>
                <td><input type="time" class="time-end"></td>
                <td><input type="time" class="rest-begin"> - <input type="time" class="rest-end"></td>
                <td><button class="delete" onclick="deleteTimeSlot(this)">åˆ é™¤</button></td>
            `;
            tbody.appendChild(newRow);
        }

        // åˆ é™¤æ—¶é—´æ®µ
        function deleteTimeSlot(button) {
            const row = button.closest('tr');
            row.remove();
            // é‡æ–°ç¼–å·
            const tbody = document.getElementById('timeTable').querySelector('tbody');
            Array.from(tbody.children).forEach((row, index) => {
                row.cells[0].textContent = index + 1;
            });
        }

        // åˆå§‹åŒ–æ—¶é—´è¡¨
        function initTimeTable(config) {
            const tbody = document.getElementById('timeTable').querySelector('tbody');
            tbody.innerHTML = '';

            config.lessons.times.schedule.forEach(slot => {
                const row = document.createElement('tr');
                const [restBegin, restEnd] = slot.rest ? slot.rest.split('-') : ['', ''];
                row.innerHTML = `
                    <td>${slot.period}</td>
                    <td><input type="time" class="time-begin" value="${slot.begin}"></td>
                    <td><input type="time" class="time-end" value="${slot.end}"></td>
                    <td><input type="time" class="rest-begin" value="${restBegin}"> - <input type="time" class="rest-end" value="${restEnd}"></td>
                    <td><button class="delete" onclick="deleteTimeSlot(this)">åˆ é™¤</button></td>
                `;
                tbody.appendChild(row);
            });
        }


        // è·å–æ—¶é—´è¡¨æ•°æ®
        function getTimeData() {
            const tbody = document.getElementById('timeTable').querySelector('tbody');
            const schedule = [];

            Array.from(tbody.children).forEach(row => {
                const period = parseInt(row.cells[0].textContent);
                const begin = row.querySelector('.time-begin').value;
                const end = row.querySelector('.time-end').value;
                const restBegin = row.querySelector('.rest-begin').value;
                const restEnd = row.querySelector('.rest-end').value;

                schedule.push({
                    period: period,
                    begin: begin,
                    end: end,
                    rest: restBegin && restEnd ? `${restBegin}-${restEnd}` : null
                });
            });

            return schedule;
        }

        // å¯¼å…¥è¯¾ç¨‹è¡¨
        function importSchedule() {
            try {
                const importText = document.getElementById('schedule-import').value.trim();
                if (!importText) {
                    showStatus('è¯·è¾“å…¥è¯¾ç¨‹è¡¨æ–‡æœ¬', 'error');
                    return;
                }

                // æŒ‰è¡Œåˆ†å‰²
                const lines = importText.split('\n');
                if (lines.length < 2) {
                    showStatus('è¯¾ç¨‹è¡¨æ ¼å¼ä¸æ­£ç¡®', 'error');
                    return;
                }

                // è§£æè¡¨å¤´
                let headers = lines[0].split(',').map(h => h.trim());
                // å¦‚æœè¡¨å¤´æœ€åä¸€ä¸ªå…ƒç´ ä¸ºç©ºï¼Œåˆ™å»é™¤
                if (headers.length > 0 && headers[headers.length - 1] === '') {
                    headers.pop();
                }
                headers = headers.filter(h => h);
                if (headers.length < 2) {
                    showStatus('è¯¾ç¨‹è¡¨è¡¨å¤´æ ¼å¼ä¸æ­£ç¡®', 'error');
                    return;
                }

                // è§£æè¯¾ç¨‹æ•°æ®
                const schedule = [];
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    let cells = line.split(',').map(c => c.trim());
                    // å¦‚æœæœ€åä¸€ä¸ªå…ƒç´ ä¸ºç©ºï¼Œåˆ™å»é™¤
                    if (cells.length > 0 && cells[cells.length - 1] === '') {
                        cells.pop();
                    }
                    if (cells.length < 2) continue;

                    schedule.push({
                        day: cells[0],
                        classes: cells.slice(1)
                    });
                }

                if (schedule.length === 0) {
                    showStatus('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è¯¾ç¨‹æ•°æ®', 'error');
                    return;
                }

                // æ›´æ–°CONFIG
                CONFIG.lessons.headers = headers;
                CONFIG.lessons.schedule = schedule;

                // é‡æ–°åˆå§‹åŒ–è¯¾ç¨‹è¡¨
                initScheduleTable(CONFIG);
                showStatus('è¯¾ç¨‹è¡¨å¯¼å…¥æˆåŠŸ', 'success');
            } catch (e) {
                console.error('å¯¼å…¥è¯¾ç¨‹è¡¨å¤±è´¥:', e);
                showStatus('å¯¼å…¥è¯¾ç¨‹è¡¨å¤±è´¥: ' + e, 'error');
            }
        }

        // é‡å‘½åå‡½æ•°ä»¥é¿å…å†²çª
        async function handleSave() {
            try {
                // ç­‰å¾…æ‰€æœ‰å¿…è¦çš„å‡½æ•°ç»‘å®š
                await Promise.all([
                    waitForBinding('saveConfig'),
                    waitForBinding('writeFile'),
                    waitForBinding('reloadMainWindow')
                ]);

                // ç¡®ä¿CONFIGå·²ç»åŠ è½½
                if (typeof CONFIG === 'undefined') {
                    showStatus('ä¿å­˜å¤±è´¥ï¼šCONFIGæœªå®šä¹‰', 'error');
                    return;
                }

                // æ›´æ–°CONFIGå¯¹è±¡
                CONFIG.lessons.schedule = getScheduleData();
                CONFIG.lessons.times.schedule = getTimeData();
                CONFIG.lessons.times.semester = {
                    begin: document.getElementById('semester-begin').value,
                    end: document.getElementById('semester-end').value
                };

                // ä¿å­˜æç¤ºéŸ³è®¾ç½®
                CONFIG.notifications = {
                    enabled: document.getElementById('notifications-enabled').checked,
                    regularInterval: parseInt(document.getElementById('regular-interval').value) || 5,
                    endingTime: parseInt(document.getElementById('ending-time').value) || 5
                };

                // ä¿å­˜å‘¨æ•°è®¾ç½®
                CONFIG.weekOffset = {
                    enabled: document.getElementById('week-offset-enabled').checked,
                    offset: parseInt(document.getElementById('week-offset').value) || 7
                };
                CONFIG.events = getEventData();
                CONFIG.wallpapers = getWallpaperData();
                CONFIG.sth = getNoticeData();

                // ä¿å­˜è¯¾è¡¨æ˜¾ç¤ºæ¨¡å¼
                CONFIG.lessons.displayMode = document.getElementById('display-mode-scroll').checked ? 'scroll' : 'day';

                // ä¿å­˜å£çº¸åˆ‡æ¢é—´éš”
                CONFIG.wallpaperInterval = parseInt(document.getElementById('wallpaper-interval').value) || 30;

                // ä¿å­˜è¿›åº¦æ¡æè¿°
                CONFIG.progressDescription = document.getElementById('progress-description').value.trim();

                // ä¿å­˜ç™¾åˆ†æ¯”æ˜¾ç¤ºæ–¹å¼
                CONFIG.progressPercentMode = document.getElementById('progress-percent-left').checked ? 'left' : 'passed';

                // ä¿å­˜config.js
                const configContent = `const CONFIG = ${JSON.stringify(CONFIG, null, 2)};

// ä¸ºäº†ä¿æŒå‘åå…¼å®¹ï¼Œå¯¼å‡ºåŸæœ‰çš„å˜é‡å
const lessons = CONFIG.lessons.headers.join(",") + "\\n" + 
  CONFIG.lessons.schedule.map(day => " ," + day.day + "," + day.classes.join(",")).join("\\n") + "\\n";

const events = "äº‹ä»¶,æ—¥æœŸ,\\n" + 
  CONFIG.events.map(event => \`\${event.name},\${event.date},\`).join("\\n");

const wallpaperlist = CONFIG.wallpapers;

const sth = CONFIG.sth;`;

                try {
                    if (typeof window.writeFile !== 'function') {
                        throw new Error('writeFile å‡½æ•°æœªå®šä¹‰');
                    }
                    await window.writeFile('res/config/config.js', configContent);
                } catch (e) {
                    console.error('ä¿å­˜config.jså¤±è´¥:', e);
                    showStatus('ä¿å­˜config.jså¤±è´¥: ' + e, 'error');
                    return;
                }

                // ä¿å­˜config.toml
                const basicConfig = {
                    Default: {
                        URL: document.getElementById('url').value.trim(),
                        BrowserPath: document.getElementById('browser').value.trim()
                    }
                };

                try {
                    if (typeof window.saveConfig !== 'function') {
                        throw new Error('saveConfig å‡½æ•°æœªå®šä¹‰');
                    }
                    await window.saveConfig(JSON.stringify(basicConfig));

                    // é‡æ–°åŠ è½½é…ç½®å¹¶åˆ·æ–°ä¸»çª—å£
                    await handleReset();

                    // åˆ·æ–°ä¸»çª—å£
                    if (typeof window.reloadMainWindow === 'function') {
                        await window.reloadMainWindow();
                        showStatus('é…ç½®å·²ä¿å­˜å¹¶åˆ·æ–°ä¸»çª—å£', 'success');
                    } else {
                        showStatus('é…ç½®å·²ä¿å­˜ï¼ˆä¸»çª—å£åˆ·æ–°å¤±è´¥ï¼‰', 'success');
                    }
                } catch (e) {
                    console.error('ä¿å­˜config.tomlå¤±è´¥:', e);
                    showStatus('ä¿å­˜config.tomlå¤±è´¥: ' + e, 'error');
                }
            } catch (e) {
                console.error('ä¿å­˜é…ç½®å¤±è´¥:', e);
                showStatus('ä¿å­˜é…ç½®å¤±è´¥: ' + e, 'error');
            }
        }

        // é‡å‘½åå‡½æ•°ä»¥é¿å…å†²çª
        async function handleReset() {
            try {
                await waitForBinding('readConfig');

                if (typeof window.readConfig !== 'function') {
                    throw new Error('readConfig å‡½æ•°æœªå®šä¹‰');
                }
                
                const config = await window.readConfig();
                currentConfig = config;

                if (config && config.Default) {
                    document.getElementById('url').value = config.Default.URL || '';
                    document.getElementById('browser').value = config.Default.BrowserPath || '';

                    if (typeof CONFIG !== 'undefined') {
                        // è®¾ç½®å­¦æœŸæ—¶é—´
                        document.getElementById('semester-begin').value = CONFIG.lessons.times.semester.begin;
                        document.getElementById('semester-end').value = CONFIG.lessons.times.semester.end;

                        // åŠ è½½æç¤ºéŸ³è®¾ç½®
                        document.getElementById('notifications-enabled').checked = CONFIG.notifications.enabled;
                        document.getElementById('regular-interval').value = CONFIG.notifications.regularInterval;
                        document.getElementById('ending-time').value = CONFIG.notifications.endingTime;

                        // åŠ è½½å‘¨æ•°è®¾ç½®
                        document.getElementById('week-offset-enabled').checked = CONFIG.weekOffset.enabled;
                        document.getElementById('week-offset').value = CONFIG.weekOffset.offset;

                        initTimeTable(CONFIG);
                        initScheduleTable(CONFIG);
                        initEventList(CONFIG.events);
                        initWallpaperList(CONFIG.wallpapers);
                        initNotice(CONFIG.sth);

                        // åŠ è½½è¯¾è¡¨æ˜¾ç¤ºæ¨¡å¼
                        if (CONFIG.lessons.displayMode === 'day') {
                            document.getElementById('display-mode-day').checked = true;
                        } else {
                            document.getElementById('display-mode-scroll').checked = true;
                        }

                        // åŠ è½½å£çº¸åˆ‡æ¢é—´éš”
                        document.getElementById('wallpaper-interval').value = CONFIG.wallpaperInterval || 30;

                        // åŠ è½½è¿›åº¦æ¡æè¿°
                        document.getElementById('progress-description').value = CONFIG.progressDescription || '';

                        // åŠ è½½ç™¾åˆ†æ¯”æ˜¾ç¤ºæ–¹å¼
                        if (CONFIG.progressPercentMode === 'left') {
                            document.getElementById('progress-percent-left').checked = true;
                        } else {
                            document.getElementById('progress-percent-passed').checked = true;
                        }
                    } else {
                        showStatus('é…ç½®åŠ è½½å¤±è´¥ï¼šCONFIGæœªå®šä¹‰', 'error');
                    }

                    showStatus('é…ç½®å·²åŠ è½½', 'success');
                } else {
                    showStatus('é…ç½®æ ¼å¼ä¸æ­£ç¡®', 'error');
                }
            } catch (e) {
                console.error('åŠ è½½é…ç½®å¤±è´¥:', e);
                showStatus('åŠ è½½é…ç½®å¤±è´¥: ' + e, 'error');
            }
        }

        function confirmReset() {
            if (window.confirm('ç¡®å®šè¦é‡ç½®å¹¶é‡æ–°åŠ è½½æ‰€æœ‰è®¾ç½®å—ï¼Ÿæœªä¿å­˜çš„æ›´æ”¹å°†ä¸¢å¤±ã€‚')) {
                handleReset();
            }
        }

        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(message, type) {
            let status = document.getElementById('status');
            if (!status) {
                // å¦‚æœçŠ¶æ€å…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ª
                status = document.createElement('div');
                status.id = 'status';
                status.className = 'status';
                document.body.appendChild(status);
            }
            status.textContent = message;
            status.className = 'status ' + type;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        async function showResetDialog() {
            const confirmed = await showFluentDialog({
                title: 'ç¡®è®¤é‡ç½®',
                message: 'ç¡®å®šè¦é‡ç½®å¹¶é‡æ–°åŠ è½½æ‰€æœ‰è®¾ç½®å—ï¼Ÿæœªä¿å­˜çš„æ›´æ”¹å°†ä¸¢å¤±ã€‚',
                confirmText: 'é‡ç½®',
                cancelText: 'å–æ¶ˆ',
                type: 'danger'
            });
            
            if (confirmed) {
                handleReset();
            }
        }

        // å…¨å±€çš„Fluent Designå¯¹è¯æ¡†å‡½æ•°
        function showFluentDialog(options) {
            return new Promise((resolve) => {
                // åˆ›å»ºå¯¹è¯æ¡†å…ƒç´ 
                const dialog = document.createElement('div');
                dialog.className = 'fluent-dialog-overlay';
                dialog.innerHTML = `
                    <div class="fluent-dialog">
                        <div class="fluent-dialog-header">
                            <div class="fluent-dialog-icon">${options.type === 'danger' ? 'âš ï¸' : options.type === 'info' ? 'â„¹ï¸' : 'â“'}</div>
                            <h3 class="fluent-dialog-title">${options.title || 'ç¡®è®¤'}</h3>
                            <button class="fluent-dialog-close" onclick="this.closest('.fluent-dialog-overlay').remove()">Ã—</button>
                        </div>
                        <div class="fluent-dialog-content">
                            <p class="fluent-dialog-message">${options.message || ''}</p>
                        </div>
                        <div class="fluent-dialog-footer">
                            <button class="fluent-button fluent-button-secondary" onclick="this.closest('.fluent-dialog-overlay').remove(); window.__fluentDialogResolve(false);">${options.cancelText || 'å–æ¶ˆ'}</button>
                            <button class="fluent-button ${options.type === 'danger' ? 'fluent-button-danger' : 'fluent-button-primary'}" onclick="this.closest('.fluent-dialog-overlay').remove(); window.__fluentDialogResolve(true);">${options.confirmText || 'ç¡®å®š'}</button>
                        </div>
                    </div>
                `;
                
                // æ·»åŠ æ ·å¼
                if (!document.querySelector('#fluent-dialog-styles')) {
                    const style = document.createElement('style');
                    style.id = 'fluent-dialog-styles';
                    style.textContent = `
                        .fluent-dialog-overlay {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0, 0, 0, 0.32);
                            backdrop-filter: blur(8px);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            z-index: 10000;
                            animation: fadeIn 0.15s ease-out;
                        }
                        
                        .fluent-dialog {
                            background: var(--card-bg);
                            border-radius: 12px;
                            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.24), 0 0 0 1px rgba(255, 255, 255, 0.08);
                            min-width: 400px;
                            max-width: 520px;
                            margin: 20px;
                            animation: slideUp 0.2s ease-out;
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            overflow: hidden;
                        }
                        
                        .fluent-dialog-header {
                            display: flex;
                            align-items: center;
                            padding: 20px 24px 0;
                            gap: 12px;
                        }
                        
                        .fluent-dialog-icon {
                            font-size: 20px;
                            width: 24px;
                            height: 24px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            flex-shrink: 0;
                        }
                        
                        .fluent-dialog-title {
                            font-size: 20px;
                            font-weight: 600;
                            margin: 0;
                            color: var(--text-color);
                            flex: 1;
                        }
                        
                        .fluent-dialog-close {
                            background: none;
                            border: none;
                            font-size: 20px;
                            cursor: pointer;
                            color: var(--text-color-secondary);
                            padding: 0;
                            width: 32px;
                            height: 32px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 4px;
                            transition: all 0.15s ease;
                        }
                        
                        .fluent-dialog-close:hover {
                            background: var(--hover-color);
                            color: var(--text-color);
                        }
                        
                        .fluent-dialog-content {
                            padding: 8px 24px 24px;
                        }
                        
                        .fluent-dialog-message {
                            font-size: 15px;
                            color: var(--text-color-secondary);
                            line-height: 1.5;
                            margin: 0;
                        }
                        
                        .fluent-dialog-footer {
                            display: flex;
                            gap: 12px;
                            justify-content: flex-end;
                            padding: 0 24px 20px;
                        }
                        
                        .fluent-button {
                            padding: 8px 16px;
                            border: 1px solid var(--border-color);
                            border-radius: 6px;
                            background: var(--card-bg);
                            color: var(--text-color);
                            font-size: 14px;
                            font-weight: 500;
                            cursor: pointer;
                            transition: all 0.15s ease;
                            font-family: inherit;
                            min-width: 80px;
                            height: 36px;
                            display: inline-flex;
                            align-items: center;
                            justify-content: center;
                        }
                        
                        .fluent-button:hover {
                            background: var(--hover-color);
                            border-color: var(--border-color-hover);
                        }
                        
                        .fluent-button:active {
                            transform: scale(0.98);
                        }
                        
                        .fluent-button-primary {
                            background: var(--primary-color);
                            color: white;
                            border-color: var(--primary-color);
                            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
                        }
                        
                        .fluent-button-primary:hover {
                            background: var(--secondary-color);
                            border-color: var(--secondary-color);
                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
                        }
                        
                        .fluent-button-danger {
                            background: var(--danger-color);
                            color: white;
                            border-color: var(--danger-color);
                            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
                        }
                        
                        .fluent-button-danger:hover {
                            background: #a4262c;
                            border-color: #a4262c;
                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
                        }
                        
                        @keyframes fadeIn {
                            from { opacity: 0; }
                            to { opacity: 1; }
                        }
                        
                        @keyframes slideUp {
                            from {
                                opacity: 0;
                                transform: translateY(10px) scale(0.98);
                            }
                            to {
                                opacity: 1;
                                transform: translateY(0) scale(1);
                            }
                        }
                        
                        @media (max-width: 600px) {
                            .fluent-dialog {
                                min-width: 280px;
                                margin: 16px;
                            }
                            
                            .fluent-dialog-header {
                                padding: 16px 20px 0;
                            }
                            
                            .fluent-dialog-content {
                                padding: 8px 20px 20px;
                            }
                            
                            .fluent-dialog-footer {
                                padding: 0 20px 16px;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                window.__fluentDialogResolve = resolve;
                document.body.appendChild(dialog);
                
                // æ·»åŠ é®ç½©å±‚ç‚¹å‡»å…³é—­
                dialog.addEventListener('click', (e) => {
                    if (e.target === dialog) {
                        dialog.remove();
                        resolve(false);
                    }
                });
                
                // ESCé”®å…³é—­
                const escHandler = (e) => {
                    if (e.key === 'Escape') {
                        dialog.remove();
                        resolve(false);
                        document.removeEventListener('keydown', escHandler);
                    }
                };
                document.addEventListener('keydown', escHandler);
            });
        }

        function smartGuessTimeTable() {
            const tbody = document.getElementById('timeTable').querySelector('tbody');
            const rows = Array.from(tbody.children);
            // æ‰¾åˆ°æœ€åä¸€ä¸ªå·²å®Œæ•´å¡«å†™çš„èŠ‚æ¬¡
            let lastIdx = -1;
            let lastEnd = '';
            let lastRest = '';
            for (let i = 0; i < rows.length; i++) {
                const begin = rows[i].querySelector('.time-begin').value;
                const end = rows[i].querySelector('.time-end').value;
                const restBegin = rows[i].querySelector('.rest-begin').value;
                const restEnd = rows[i].querySelector('.rest-end').value;
                if (begin && end && restBegin && restEnd) {
                    lastIdx = i;
                    lastEnd = end;
                    lastRest = restEnd;
                }
            }
            if (lastIdx === -1 || lastIdx === rows.length - 1) {
                showStatus('è¯·å…ˆæ‰‹åŠ¨å¡«å†™å‰å‡ èŠ‚è¯¾çš„æ—¶é—´ï¼ˆè‡³å°‘ä¸€èŠ‚ï¼‰ï¼Œå†ä½¿ç”¨æ™ºèƒ½æ¨ç®—ã€‚', 'error');
                return;
            }
            // è®¡ç®—è¯¾æ—¶ã€ä¼‘æ¯æ—¶é•¿
            function timeStrToMin(t) {
                const [h, m] = t.split(':').map(Number);
                return h * 60 + m;
            }
            function minToTimeStr(m) {
                const h = Math.floor(m / 60).toString().padStart(2, '0');
                const mm = (m % 60).toString().padStart(2, '0');
                return `${h}:${mm}`;
            }
            const prevBegin = rows[lastIdx].querySelector('.time-begin').value;
            const prevEnd = rows[lastIdx].querySelector('.time-end').value;
            const prevRestBegin = rows[lastIdx].querySelector('.rest-begin').value;
            const prevRestEnd = rows[lastIdx].querySelector('.rest-end').value;
            const classLen = timeStrToMin(prevEnd) - timeStrToMin(prevBegin);
            let restLen = timeStrToMin(prevRestEnd) - timeStrToMin(prevEnd);
            if (restLen <= 0) restLen = 10; // é»˜è®¤10åˆ†é’Ÿ
            // è¡¥å…¨åç»­èŠ‚æ¬¡
            let curTime = timeStrToMin(prevRestEnd);
            for (let i = lastIdx + 1; i < rows.length; i++) {
                // ä¸Šè¯¾æ—¶é—´
                const begin = minToTimeStr(curTime);
                // ä¸‹è¯¾æ—¶é—´
                const end = minToTimeStr(curTime + classLen);
                // ä¼‘æ¯æ—¶é—´
                let nextRestLen = restLen;
                // è‹¥ä¸Šä¸€èŠ‚ä¼‘æ¯å¤§äº30åˆ†é’Ÿï¼Œæ¨æ–­ä¸ºåˆä¼‘/æ™šä¼‘ï¼Œåç»­ä¼‘æ¯æ¢å¤ä¸º10åˆ†é’Ÿ
                if (restLen >= 30) nextRestLen = 10;
                const restBegin = end;
                const restEnd = minToTimeStr(timeStrToMin(end) + nextRestLen);
                // å¡«å…¥è¡¨æ ¼
                rows[i].querySelector('.time-begin').value = begin;
                rows[i].querySelector('.time-end').value = end;
                rows[i].querySelector('.rest-begin').value = restBegin;
                rows[i].querySelector('.rest-end').value = restEnd;
                // æ›´æ–°æ¨ç®—åŸºå‡†
                curTime = timeStrToMin(restEnd);
                restLen = nextRestLen;
            }
            showStatus('å·²æ ¹æ®å·²å¡«æ—¶é—´æ™ºèƒ½è¡¥å…¨åç»­èŠ‚æ¬¡ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µå¾®è°ƒã€‚', 'success');
        }


        async function openInBrowser() {
            const url = document.getElementById('url').value.trim();
            if (!url) {
                showStatus('è¯·å…ˆè¾“å…¥æœ‰æ•ˆçš„URL', 'error');
                return;
            }

            try {
                await waitForBinding('openURLInBrowser');
                const result = await window.openURLInBrowser(url);
                showStatus(result ? 'å·²åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é¡µé¢' : 'æ‰“å¼€æµè§ˆå™¨å¤±è´¥',
                    result ? 'success' : 'error');
            } catch (e) {
                console.error('æ‰“å¼€æµè§ˆå™¨å¤±è´¥:', e);
                showStatus('æ‰“å¼€æµè§ˆå™¨å¤±è´¥: ' + e.message, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è¯»å–é…ç½®
        document.addEventListener('DOMContentLoaded', handleReset);
        
        // å…¨å±€ç‚¹å‡»äº‹ä»¶ï¼Œç¡®ä¿ç‚¹å‡»å…¶ä»–åœ°æ–¹æ—¶å®Œæˆç¼–è¾‘
        document.addEventListener('click', (e) => {
            if (window.tableEditor && tableEditor.editingCell) {
                const editingCell = tableEditor.editingCell;
                const clickedInsideCell = e.target === editingCell || editingCell.contains(e.target);
                if (!clickedInsideCell && !e.target.classList.contains('edit-input')) {
                    tableEditor.finishEditing();
                }
            }
        });

        // Officeé£æ ¼è¡¨æ ¼ç¼–è¾‘åŠŸèƒ½
        class OfficeTableEditor {
            constructor(tableId) {
                this.table = document.getElementById(tableId);
                this.selectedCells = [];
                this.copiedData = [];
                this.history = [];
                this.historyIndex = -1;
                this.isSelecting = false;
                this.startCell = null;
                this.editingCell = null;
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupTouchSupport();
                this.createContextMenu();
            }

            setupEventListeners() {
                // é¼ æ ‡äº‹ä»¶
                this.table.addEventListener('click', (e) => this.handleCellClick(e));
                this.table.addEventListener('mousedown', (e) => this.handleMouseDown(e));
                this.table.addEventListener('mouseover', (e) => this.handleMouseOver(e));
                this.table.addEventListener('mouseup', (e) => this.handleMouseUp(e));
                this.table.addEventListener('dblclick', (e) => {
                    const cell = this.getCellFromEvent(e);
                    if (cell && cell.tagName !== 'TH' && !cell.classList.contains('schedule-day')) {
                        this.startEditing(cell);
                    }
                });
                
                // é”®ç›˜äº‹ä»¶
                document.addEventListener('keydown', (e) => this.handleKeyDown(e));
                
                // å³é”®èœå•
                this.table.addEventListener('contextmenu', (e) => this.handleContextMenu(e));
            }

            setupTouchSupport() {
                let touchTimer = null;
                let touchStartTime = 0;
                let touchStartPos = { x: 0, y: 0 };

                this.table.addEventListener('touchstart', (e) => {
                    const touch = e.touches[0];
                    touchStartPos = { x: touch.clientX, y: touch.clientY };
                    touchStartTime = Date.now();
                    
                    // é•¿æŒ‰æ£€æµ‹
                    touchTimer = setTimeout(() => {
                        const cell = this.getCellFromEvent(e);
                        if (cell) {
                            this.showLongPressMenu(e, cell);
                        }
                    }, 500);
                });

                this.table.addEventListener('touchmove', (e) => {
                    const touch = e.touches[0];
                    const distance = Math.sqrt(
                        Math.pow(touch.clientX - touchStartPos.x, 2) + 
                        Math.pow(touch.clientY - touchStartPos.y, 2)
                    );
                    
                    if (distance > 10) {
                        clearTimeout(touchTimer);
                    }
                });

                this.table.addEventListener('touchend', (e) => {
                    clearTimeout(touchTimer);
                    
                    const touchDuration = Date.now() - touchStartTime;
                    if (touchDuration < 500) {
                        const cell = this.getCellFromEvent(e);
                        if (cell) {
                            this.handleCellClick(e);
                        }
                    }
                });
            }

            getCellFromEvent(e) {
                const target = e.target;
                if (target.tagName === 'TD' || target.tagName === 'TH') {
                    return target;
                }
                return target.closest('td') || target.closest('th');
            }

            handleCellClick(e) {
                const cell = this.getCellFromEvent(e);
                if (!cell || cell.tagName === 'TH') return;

                if (e.ctrlKey || e.metaKey) {
                    this.toggleCellSelection(cell);
                } else {
                    this.selectCell(cell);
                }
            }

            handleMouseDown(e) {
                const cell = this.getCellFromEvent(e);
                if (!cell || cell.tagName === 'TH') return;

                this.isSelecting = true;
                this.startCell = cell;
                this.selectCell(cell);
                e.preventDefault();
            }

            handleMouseOver(e) {
                if (!this.isSelecting) return;
                
                const cell = this.getCellFromEvent(e);
                if (!cell || cell.tagName === 'TH') return;

                this.selectRange(this.startCell, cell);
            }

            handleMouseUp() {
                this.isSelecting = false;
            }

            handleKeyDown(e) {
                // å¦‚æœæ­£åœ¨ç¼–è¾‘ï¼Œä¸å¤„ç†é”®ç›˜äº‹ä»¶
                if (this.editingCell) return;
                
                if (this.selectedCells.length === 0) return;

                switch(e.key) {
                    case 'Delete':
                        this.clearSelectedCells();
                        break;
                    case 'c':
                        if (e.ctrlKey || e.metaKey) {
                            this.copyCells();
                            e.preventDefault();
                        }
                        break;
                    case 'v':
                        if (e.ctrlKey || e.metaKey) {
                            this.pasteCells();
                            e.preventDefault();
                        }
                        break;
                    case 'z':
                        if (e.ctrlKey || e.metaKey) {
                            if (e.shiftKey) {
                                this.redoAction();
                            } else {
                                this.undoAction();
                            }
                            e.preventDefault();
                        }
                        break;
                    case 'Enter':
                        this.startEditing(this.selectedCells[0]);
                        e.preventDefault();
                        break;
                }
            }

            handleContextMenu(e) {
                e.preventDefault();
                const cell = this.getCellFromEvent(e);
                if (cell && cell.tagName !== 'TH') {
                    this.showContextMenu(e, cell);
                }
            }

            selectCell(cell) {
                this.clearSelection();
                this.selectedCells = [cell];
                cell.classList.add('selected');
            }

            toggleCellSelection(cell) {
                const index = this.selectedCells.indexOf(cell);
                if (index > -1) {
                    this.selectedCells.splice(index, 1);
                    cell.classList.remove('selected');
                } else {
                    this.selectedCells.push(cell);
                    cell.classList.add('selected');
                }
            }

            selectRange(startCell, endCell) {
                this.clearSelection();
                
                const startRow = startCell.parentElement.rowIndex;
                const startCol = startCell.cellIndex;
                const endRow = endCell.parentElement.rowIndex;
                const endCol = endCell.cellIndex;
                
                const minRow = Math.min(startRow, endRow);
                const maxRow = Math.max(startRow, endRow);
                const minCol = Math.min(startCol, endCol);
                const maxCol = Math.max(startCol, endCol);

                this.selectedCells = [];
                for (let row = minRow; row <= maxRow; row++) {
                    for (let col = minCol; col <= maxCol; col++) {
                        const cell = this.table.rows[row].cells[col];
                        if (cell && cell.tagName !== 'TH') {
                            cell.classList.add('selected');
                            this.selectedCells.push(cell);
                        }
                    }
                }
            }

            clearSelection() {
                this.selectedCells.forEach(cell => cell.classList.remove('selected'));
                this.selectedCells = [];
            }

            startEditing(cell) {
                if (!cell || cell.tagName === 'TH' || cell.classList.contains('schedule-day')) return;
                
                // å¦‚æœå·²ç»åœ¨ç¼–è¾‘ï¼Œå…ˆå®Œæˆå½“å‰ç¼–è¾‘
                if (this.editingCell && this.editingCell !== cell) {
                    this.finishEditing();
                }
                
                this.editingCell = cell;
                cell.classList.add('editing');
                
                const originalValue = cell.textContent.trim();
                cell.dataset.originalValue = originalValue;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.value = originalValue;
                input.className = 'edit-input';
                input.style.cssText = `
                    width: 100% !important;
                    height: 100% !important;
                    border: 2px solid var(--primary-color) !important;
                    background: var(--card-bg) !important;
                    color: var(--text-color) !important;
                    font-size: inherit !important;
                    font-family: inherit !important;
                    text-align: center !important;
                    padding: 8px !important;
                    margin: 0 !important;
                    outline: none !important;
                    box-sizing: border-box !important;
                    border-radius: 4px !important;
                    z-index: 1000 !important;
                    position: relative !important;
                `;
                
                cell.innerHTML = '';
                cell.appendChild(input);
                input.focus();
                input.select();

                const finishEditing = () => {
                    if (!this.editingCell || this.editingCell !== cell) return;
                    
                    const newValue = input.value.trim();
                    if (newValue !== originalValue) {
                        this.saveState();
                        cell.textContent = newValue;
                    } else {
                        cell.textContent = originalValue;
                    }
                    cell.classList.remove('editing');
                    delete cell.dataset.originalValue;
                    this.editingCell = null;
                };

                input.addEventListener('blur', finishEditing);
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        finishEditing();
                        e.preventDefault();
                        e.stopPropagation();
                    } else if (e.key === 'Escape') {
                        cell.textContent = originalValue;
                        cell.classList.remove('editing');
                        delete cell.dataset.originalValue;
                        this.editingCell = null;
                        e.preventDefault();
                        e.stopPropagation();
                    }
                });

                // é˜²æ­¢äº‹ä»¶å†’æ³¡
                input.addEventListener('mousedown', (e) => e.stopPropagation());
                input.addEventListener('click', (e) => e.stopPropagation());
                input.addEventListener('dblclick', (e) => e.stopPropagation());
            }
            
            finishEditing() {
                if (!this.editingCell) return;
                
                const cell = this.editingCell;
                const input = cell.querySelector('.edit-input');
                if (input) {
                    const originalValue = cell.dataset.originalValue || '';
                    const newValue = input.value.trim();
                    
                    if (newValue !== originalValue) {
                        this.saveState();
                        cell.textContent = newValue;
                    } else {
                        cell.textContent = originalValue;
                    }
                }
                
                cell.classList.remove('editing');
                delete cell.dataset.originalValue;
                this.editingCell = null;
            }

            addRow() {
                this.saveState();
                const tbody = this.table.querySelector('tbody');
                const newRow = tbody.insertRow();
                const headerCells = this.table.querySelector('thead tr').cells;
                
                for (let i = 0; i < headerCells.length; i++) {
                    const cell = newRow.insertCell();
                    if (i === 0) {
                        cell.textContent = 'æ–°è¡Œ';
                        cell.style.fontWeight = 'bold';
                    } else {
                        cell.textContent = '';
                        cell.classList.add('schedule-cell');
                    }
                }
            }

            addColumn() {
                this.saveState();
                const headerRow = this.table.querySelector('thead tr');
                const newHeader = headerRow.insertCell();
                newHeader.textContent = 'æ–°åˆ—';
                
                const rows = this.table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const newCell = row.insertCell();
                    newCell.textContent = '';
                    newCell.classList.add('schedule-cell');
                });
            }


            deleteSelected() {
                if (this.selectedCells.length === 0) return;
                
                this.saveState();
                this.selectedCells.forEach(cell => {
                    cell.textContent = '';
                });
            }

            clearCells() {
                if (this.selectedCells.length === 0) return;
                
                this.saveState();
                this.selectedCells.forEach(cell => {
                    cell.textContent = '';
                });
            }

            copyCells() {
                if (this.selectedCells.length === 0) return;
                
                this.copiedData = this.selectedCells.map(cell => cell.textContent);
            }

            pasteCells() {
                if (this.copiedData.length === 0 || this.selectedCells.length === 0) return;
                
                this.saveState();
                this.selectedCells.forEach((cell, index) => {
                    cell.textContent = this.copiedData[index % this.copiedData.length];
                });
            }

            mergeCells() {
                if (this.selectedCells.length < 2) {
                    showStatus('è¯·é€‰æ‹©è‡³å°‘ä¸¤ä¸ªå•å…ƒæ ¼è¿›è¡Œåˆå¹¶', 'error');
                    return;
                }

                this.saveState();

                try {
                    const tbody = this.table.querySelector('tbody');
                    const positions = this.selectedCells.map(cell => {
                        const row = cell.parentElement;
                        return {
                            cell,
                            row: Array.from(tbody.children).indexOf(row),
                            col: Array.from(row.children).indexOf(cell)
                        };
                    });

                    const minRow = Math.min(...positions.map(p => p.row));
                    const maxRow = Math.max(...positions.map(p => p.row));
                    const minCol = Math.min(...positions.map(p => p.col));
                    const maxCol = Math.max(...positions.map(p => p.col));

                    // éªŒè¯çŸ©å½¢åŒºåŸŸ
                    const expected = (maxRow - minRow + 1) * (maxCol - minCol + 1);
                    if (expected !== positions.length) {
                        showStatus('è¯·é€‰æ‹©è¿ç»­çš„çŸ©å½¢åŒºåŸŸè¿›è¡Œåˆå¹¶', 'error');
                        return;
                    }

                    const firstCell = tbody.children[minRow].cells[minCol];
                    
                    // æ”¶é›†å®Œæ•´çš„åŸå§‹å†…å®¹çŸ©é˜µ
                    const originalData = {
                        content: []
                    };

                    // ä¿å­˜å†…å®¹çŸ©é˜µ
                    for (let r = minRow; r <= maxRow; r++) {
                        originalData.content[r - minRow] = [];
                        for (let c = minCol; c <= maxCol; c++) {
                            originalData.content[r - minRow][c - minCol] = tbody.children[r].cells[c].textContent;
                        }
                    }

                    // åˆå¹¶å†…å®¹ï¼ˆè¡Œåˆ—ç”¨æ¢è¡Œåˆ†éš”ï¼Œè¡Œå†…ç”¨ç©ºæ ¼åˆ†éš”ï¼‰
                    firstCell.textContent = originalData.content.map(row => row.join(' ')).join('\n');
                    firstCell.setAttribute('data-merged-content', JSON.stringify(originalData));

                    // æ¸…ç©ºå…¶ä»–å•å…ƒæ ¼
                    positions.forEach(pos => {
                        if (pos.cell !== firstCell) pos.cell.textContent = '';
                    });

                    showStatus(`åˆå¹¶ ${maxRow-minRow+1}è¡Œ Ã— ${maxCol-minCol+1}åˆ—`, 'success');
                } catch (e) {
                    showStatus('åˆå¹¶å¤±è´¥: ' + e.message, 'error');
                }
            }

            splitCell() {
                if (this.selectedCells.length !== 1) {
                    showStatus('è¯·é€‰æ‹©ä¸€ä¸ªå•å…ƒæ ¼è¿›è¡Œæ‹†åˆ†', 'error');
                    return;
                }

                const cell = this.selectedCells[0];
                const mergedData = cell.getAttribute('data-merged-content');

                if (!mergedData) {
                    // æ™®é€šæ–‡æœ¬æŒ‰è¡Œåˆ†å‰²
                    const lines = cell.textContent.trim().split('\n');
                    if (lines.length < 2) {
                        showStatus('æ— æ³•åˆ†å‰²å•è¡Œæ–‡æœ¬', 'error');
                        return;
                    }

                    this.saveState();
                    const tbody = this.table.querySelector('tbody');
                    const rowIdx = Array.from(tbody.children).indexOf(cell.parentElement);
                    const colIdx = Array.from(cell.parentElement.children).indexOf(cell);

                    cell.textContent = lines[0];
                    for (let i = 1; i < lines.length; i++) {
                        while (rowIdx + i >= tbody.children.length) this.addRow();
                        const target = tbody.children[rowIdx + i].cells[colIdx];
                        if (target) target.textContent = lines[i];
                    }
                    
                    showStatus(`æŒ‰è¡Œåˆ†å‰²ä¸º ${lines.length} éƒ¨åˆ†`, 'success');
                    return;
                }

                // ä»¥å½“å‰å•å…ƒæ ¼ä¸ºèµ·ç‚¹å‘å³å‘ä¸‹å±•å¼€è¿˜åŸ
                this.saveState();
                try {
                    const originalData = JSON.parse(mergedData);
                    const rows = originalData.content.length;
                    const cols = originalData.content[0] ? originalData.content[0].length : 1;
                    
                    const tbody = this.table.querySelector('tbody');
                    const startRow = Array.from(tbody.children).indexOf(cell.parentElement);
                    const startCol = Array.from(cell.parentElement.children).indexOf(cell);
                    
                    // ç¡®ä¿è¡¨æ ¼æœ‰è¶³å¤Ÿçš„è¡Œåˆ—
                    const requiredRows = startRow + rows;
                    const requiredCols = startCol + cols;
                    
                    while (tbody.children.length < requiredRows) {
                        this.addRow();
                    }
                    
                    for (let r = 0; r < rows; r++) {
                        const targetRow = startRow + r;
                        while (tbody.children[targetRow] && tbody.children[targetRow].cells.length < requiredCols) {
                            this.addColumn();
                        }
                    }
                    
                    // ä»¥å½“å‰å•å…ƒæ ¼ä¸ºèµ·ç‚¹å‘å³å‘ä¸‹å±•å¼€å¡«å……å†…å®¹
                    for (let r = 0; r < rows; r++) {
                        for (let c = 0; c < cols; c++) {
                            const targetRow = startRow + r;
                            const targetCol = startCol + c;
                            
                            if (tbody.children[targetRow] && tbody.children[targetRow].cells[targetCol]) {
                                tbody.children[targetRow].cells[targetCol].textContent = originalData.content[r][c];
                            }
                        }
                    }

                    // æ¸…é™¤åˆå¹¶ç›¸å…³çš„å±æ€§
                    cell.removeAttribute('data-merged-content');
                    cell.removeAttribute('data-merged-info');
                    
                    showStatus(`ä»¥å½“å‰æ ¼ä¸ºèµ·ç‚¹å±•å¼€ ${rows}è¡Œ Ã— ${cols}åˆ—`, 'success');
                } catch (e) {
                    showStatus('è¿˜åŸå¤±è´¥: ' + e.message, 'error');
                }
            }

        

            // æ–°å¢ï¼šæ‰¹é‡å¡«å……åºåˆ—
            fillSeries() {
                if (this.selectedCells.length < 2) {
                    showStatus('è¯·è‡³å°‘é€‰æ‹©2ä¸ªå•å…ƒæ ¼æ¥å¡«å……åºåˆ—', 'error');
                    return;
                }
                
                // ä¿å­˜å½“å‰é€‰ä¸­çŠ¶æ€ç”¨äºæ’¤é”€
                this.saveState();
                
                const values = this.selectedCells.map(cell => {
                    const text = cell.textContent.trim();
                    const num = parseFloat(text);
                    return isNaN(num) ? text : num; // ä¿ç•™åŸå§‹æ–‡æœ¬ç”¨äºéæ•°å­—åºåˆ—
                });
                
                // æ£€æµ‹åºåˆ—ç±»å‹
                let isNumeric = values.every(v => !isNaN(parseFloat(v)));
                
                if (isNumeric) {
                    // æ•°å­—åºåˆ—
                    const numValues = values.map(v => parseFloat(v));
                    let step = 1;
                    if (numValues.length >= 2) {
                        step = numValues[1] - numValues[0];
                    }
                    
                    let currentValue = numValues[0];
                    this.selectedCells.forEach((cell, index) => {
                        if (index === 0) return;
                        currentValue += step;
                        cell.textContent = currentValue.toString();
                    });
                } else {
                    // æ–‡æœ¬åºåˆ—ï¼šæ£€æµ‹æ˜¯å¦æœ‰æ•°å­—åç¼€
                    const patterns = values.map(v => {
                        const match = v.toString().match(/^(.*?)(\d+)$/);
                        if (match) {
                            return { prefix: match[1], number: parseInt(match[2]) };
                        }
                        return null;
                    });
                    
                    if (patterns.every(p => p !== null)) {
                        // æœ‰æ•°å­—åç¼€çš„æ–‡æœ¬åºåˆ—
                        let step = 1;
                        if (patterns.length >= 2) {
                            step = patterns[1].number - patterns[0].number;
                        }
                        
                        let currentNumber = patterns[0].number;
                        const prefix = patterns[0].prefix;
                        
                        this.selectedCells.forEach((cell, index) => {
                            if (index === 0) return;
                            currentNumber += step;
                            cell.textContent = prefix + currentNumber;
                        });
                    } else {
                        // ç®€å•å¤åˆ¶ç¬¬ä¸€ä¸ªå€¼
                        const firstValue = values[0];
                        this.selectedCells.forEach((cell, index) => {
                            if (index === 0) return;
                            cell.textContent = firstValue;
                        });
                    }
                }
                
                showStatus('åºåˆ—å¡«å……å®Œæˆ', 'success');
            }

            // æ–°å¢ï¼šæŸ¥æ‰¾å’Œæ›¿æ¢
            findAndReplace() {
                this.showFindReplaceDialog();
            }

            // æ–°å¢ï¼šè·å–æ’¤é”€/é‡åšçŠ¶æ€
            getUndoRedoStatus() {
                return {
                    canUndo: this.historyIndex > 0,
                    canRedo: this.historyIndex < this.history.length - 1,
                    undoCount: this.historyIndex,
                    redoCount: this.history.length - 1 - this.historyIndex,
                    maxHistory: 50,
                    currentIndex: this.historyIndex,
                    totalStates: this.history.length,
                    isEmpty: this.history.length === 0
                }
            }

            // æ¸…ç©ºå•å…ƒæ ¼å†…å®¹
            clearCells() {
                if (this.selectedCells.length === 0) {
                    showStatus('è¯·å…ˆé€‰æ‹©è¦æ¸…ç©ºçš„å•å…ƒæ ¼', 'error');
                    return;
                }

                this.saveState();

                this.selectedCells.forEach(cell => {
                    // æ¸…ç©ºå†…å®¹
                    cell.textContent = '';
                    
                    // æ¸…é™¤åˆå¹¶ç›¸å…³çš„æ ·å¼å’Œå±æ€§
                    cell.style.backgroundColor = '';
                    cell.style.border = '';
                    cell.removeAttribute('data-merged-content');
                    cell.removeAttribute('data-original-contents');
                    cell.removeAttribute('data-merged-cells');
                    cell.removeAttribute('data-merged-empty');
                    cell.removeAttribute('data-main-cell-row');
                    cell.removeAttribute('data-main-cell-col');
                });

                showStatus(`å·²æ¸…ç©º ${this.selectedCells.length} ä¸ªå•å…ƒæ ¼`, 'success');
            }

            // æ¸…é™¤å†å²è®°å½•
            clearHistory() {
                const status = this.getUndoRedoStatus();
                if (status.totalStates > 1) {
                    this.showFluentDialog({
                        title: 'æ¸…é™¤å†å²è®°å½•',
                        message: `ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ’¤é”€/é‡åšå†å²è®°å½•å—ï¼Ÿè¿™å°†æ— æ³•æ¢å¤ã€‚å½“å‰æœ‰ ${status.totalStates} ä¸ªå†å²çŠ¶æ€ã€‚`,
                        type: 'warning',
                        confirmText: 'ç¡®å®šæ¸…é™¤',
                        cancelText: 'å–æ¶ˆ'
                    }).then(result => {
                        if (result) {
                            this.history = [this.history[this.historyIndex]];
                            this.historyIndex = 0;
                            showStatus('å†å²è®°å½•å·²æ¸…é™¤', 'success');
                            if (typeof updateUndoRedoButtons === 'function') {
                                updateUndoRedoButtons();
                            }
                        }
                    });
                } else {
                    showStatus('å½“å‰æ²¡æœ‰å†å²è®°å½•å¯æ¸…é™¤', 'info');
                }
            }

            showFindReplaceDialog() {
                // åˆ›å»ºæŸ¥æ‰¾æ›¿æ¢å¯¹è¯æ¡†
                const dialog = document.createElement('div');
                dialog.id = 'findReplaceDialog';
                dialog.className = 'find-replace-dialog';
                dialog.innerHTML = `
                    <div class="find-replace-container">
                        <div class="dialog-header">
                            <h3>æŸ¥æ‰¾å’Œæ›¿æ¢</h3>
                            <button class="close-btn" onclick="this.closest('.find-replace-dialog').remove()">&times;</button>
                        </div>
                        <div class="dialog-content">
                            <div class="form-group">
                                <label for="findText">æŸ¥æ‰¾å†…å®¹ï¼š</label>
                                <input type="text" id="findText" placeholder="è¾“å…¥è¦æŸ¥æ‰¾çš„æ–‡æœ¬" class="form-input">
                                <div class="find-options">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="matchCase"> åŒºåˆ†å¤§å°å†™
                                    </label>
                                        <label class="checkbox-label">
                                        <input type="checkbox" id="wholeWord"> å…¨è¯åŒ¹é…
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="replaceText">æ›¿æ¢ä¸ºï¼š</label>
                                <input type="text" id="replaceText" placeholder="è¾“å…¥æ›¿æ¢æ–‡æœ¬" class="form-input">
                            </div>
                            <div class="form-group">
                                <label>æŸ¥æ‰¾èŒƒå›´ï¼š</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="searchScope" value="all" checked> æ•´ä¸ªè¡¨æ ¼
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="searchScope" value="selected"> é€‰å®šå•å…ƒæ ¼
                                    </label>
                                </div>
                            </div>
                            <div class="dialog-buttons">
                                <button class="btn btn-secondary" onclick="this.closest('.find-replace-dialog').remove()">å–æ¶ˆ</button>
                                <button class="btn btn-primary" id="findBtn">æŸ¥æ‰¾</button>
                                <button class="btn btn-primary" id="replaceBtn">æ›¿æ¢</button>
                                <button class="btn btn-primary" id="replaceAllBtn">å…¨éƒ¨æ›¿æ¢</button>
                            </div>
                        </div>
                        <div class="find-results" id="findResults" style="display: none;">
                            <div class="results-header">æŸ¥æ‰¾ç»“æœ</div>
                            <div class="results-content" id="resultsContent"></div>
                        </div>
                    </div>
                `;

                // æ·»åŠ æ ·å¼
                if (!document.querySelector('#find-replace-styles')) {
                    const style = document.createElement('style');
                    style.id = 'find-replace-styles';
                    style.textContent = `
                        .find-replace-dialog {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0, 0, 0, 0.5);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            z-index: 10000;
                            backdrop-filter: blur(4px);
                        }

                        .find-replace-container {
                            background: var(--card-bg);
                            border-radius: 8px;
                            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                            min-width: 400px;
                            max-width: 500px;
                            max-height: 90vh;
                            overflow-y: auto;
                            border: 1px solid var(--border-color);
                        }

                        .dialog-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 16px 20px;
                            border-bottom: 1px solid var(--border-color);
                        }

                        .dialog-header h3 {
                            margin: 0;
                            font-size: 18px;
                            color: var(--text-color);
                        }

                        .close-btn {
                            background: none;
                            border: none;
                            font-size: 24px;
                            cursor: pointer;
                            color: var(--text-color-secondary);
                            padding: 0;
                            width: 32px;
                            height: 32px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 4px;
                            transition: all 0.2s;
                        }

                        .close-btn:hover {
                            background: var(--hover-color);
                            color: var(--text-color);
                        }

                        .dialog-content {
                            padding: 20px;
                        }

                        .form-group {
                            margin-bottom: 16px;
                        }

                        .form-group label {
                            display: block;
                            margin-bottom: 4px;
                            font-weight: 500;
                            color: var(--text-color);
                        }

                        .form-input {
                            width: 100%;
                            padding: 8px 12px;
                            border: 1px solid var(--border-color);
                            border-radius: 4px;
                            background: var(--card-bg);
                            color: var(--text-color);
                            font-size: 14px;
                        }

                        .form-input:focus {
                            outline: none;
                            border-color: var(--primary-color);
                            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
                        }

                        .find-options {
                            display: flex;
                            gap: 16px;
                            margin-top: 8px;
                        }

                        .checkbox-label, .radio-label {
                            display: flex;
                            align-items: center;
                            gap: 4px;
                            font-size: 14px;
                            cursor: pointer;
                        }

                        .radio-group {
                            display: flex;
                            gap: 16px;
                        }

                        .dialog-buttons {
                            display: flex;
                            gap: 8px;
                            justify-content: flex-end;
                            margin-top: 20px;
                        }

                        .btn {
                            padding: 8px 16px;
                            border: 1px solid transparent;
                            border-radius: 4px;
                            font-size: 14px;
                            cursor: pointer;
                            transition: all 0.2s;
                        }

                        .btn-primary {
                            background: var(--primary-color);
                            color: white;
                            border-color: var(--primary-color);
                        }

                        .btn-primary:hover {
                            background: var(--primary-hover);
                        }

                        .btn-secondary {
                            background: var(--secondary-color);
                            color: var(--text-color);
                            border-color: var(--border-color);
                        }

                        .btn-secondary:hover {
                            background: var(--hover-color);
                        }

                        .find-results {
                            border-top: 1px solid var(--border-color);
                            padding: 16px 20px;
                            background: var(--background-color);
                        }

                        .results-header {
                            font-weight: 500;
                            margin-bottom: 8px;
                            color: var(--text-color);
                        }

                        .results-content {
                            font-size: 14px;
                            color: var(--text-color-secondary);
                        }

                        .result-item {
                            padding: 4px 0;
                            cursor: pointer;
                            border-radius: 2px;
                        }

                        .result-item:hover {
                            background: var(--hover-color);
                        }
                    `;
                    document.head.appendChild(style);
                }

                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(dialog);

                // ç»‘å®šäº‹ä»¶
                const findText = dialog.querySelector('#findText');
                const replaceText = dialog.querySelector('#replaceText');
                const findBtn = dialog.querySelector('#findBtn');
                const replaceBtn = dialog.querySelector('#replaceBtn');
                const replaceAllBtn = dialog.querySelector('#replaceAllBtn');
                const matchCase = dialog.querySelector('#matchCase');
                const wholeWord = dialog.querySelector('#wholeWord');
                const searchScope = dialog.querySelectorAll('input[name="searchScope"]');

                // æŸ¥æ‰¾åŠŸèƒ½
                findBtn.addEventListener('click', () => {
                    this.performFind(findText.value, {
                        matchCase: matchCase.checked,
                        wholeWord: wholeWord.checked,
                        scope: Array.from(searchScope).find(r => r.checked).value
                    });
                });

                // æ›¿æ¢åŠŸèƒ½
                replaceBtn.addEventListener('click', () => {
                    this.performReplace(findText.value, replaceText.value, {
                        matchCase: matchCase.checked,
                        wholeWord: wholeWord.checked,
                        scope: Array.from(searchScope).find(r => r.checked).value,
                        all: false
                    });
                });

                // å…¨éƒ¨æ›¿æ¢åŠŸèƒ½
                replaceAllBtn.addEventListener('click', () => {
                    this.performReplace(findText.value, replaceText.value, {
                        matchCase: matchCase.checked,
                        wholeWord: wholeWord.checked,
                        scope: Array.from(searchScope).find(r => r.checked).value,
                        all: true
                    });
                    dialog.remove();
                });

                // èšç„¦åˆ°æŸ¥æ‰¾è¾“å…¥æ¡†
                findText.focus();
            }

            performFind(searchTerm, options = {}) {
                if (!searchTerm) return;

                const results = [];
                let targetCells = [];

                // ç¡®å®šæŸ¥æ‰¾èŒƒå›´
                if (options.scope === 'selected' && this.selectedCells.length > 0) {
                    targetCells = this.selectedCells;
                } else {
                    targetCells = Array.from(this.table.querySelectorAll('td'));
                }

                // æ‰§è¡ŒæŸ¥æ‰¾
                targetCells.forEach((cell, index) => {
                    let content = cell.textContent;
                    let searchContent = searchTerm;

                    if (!options.matchCase) {
                        content = content.toLowerCase();
                        searchContent = searchContent.toLowerCase();
                    }

                    let matches = [];
                    if (options.wholeWord) {
                        const words = content.split(/\s+/);
                        words.forEach((word, wordIndex) => {
                            if (word === searchContent) {
                                matches.push({ wordIndex, word });
                            }
                        });
                    } else {
                        let startIndex = 0;
                        let index = content.indexOf(searchContent, startIndex);
                        while (index !== -1) {
                            matches.push({ index, text: searchTerm });
                            startIndex = index + searchContent.length;
                            index = content.indexOf(searchContent, startIndex);
                        }
                    }

                    if (matches.length > 0) {
                        results.push({
                            cell: cell,
                            matches: matches,
                            cellIndex: index
                        });
                    }
                });

                // æ˜¾ç¤ºç»“æœ
                this.showFindResults(results, searchTerm);
                return results.length;
            }

            performReplace(searchTerm, replaceTerm, options = {}) {
                if (!searchTerm) return;

                let targetCells = [];
                let replacedCount = 0;

                // ç¡®å®šæ›¿æ¢èŒƒå›´
                if (options.scope === 'selected' && this.selectedCells.length > 0) {
                    targetCells = this.selectedCells;
                } else {
                    targetCells = Array.from(this.table.querySelectorAll('td'));
                }

                this.saveState();

                targetCells.forEach(cell => {
                    let content = cell.textContent;
                    let searchContent = searchTerm;
                    let originalContent = content;

                    if (!options.matchCase) {
                        content = content.toLowerCase();
                        searchContent = searchContent.toLowerCase();
                    }

                    if (options.wholeWord) {
                        const regex = new RegExp(`\\b${this.escapeRegExp(searchTerm)}\\b`, options.matchCase ? 'g' : 'gi');
                        cell.textContent = originalContent.replace(regex, replaceTerm);
                    } else {
                        const regex = new RegExp(this.escapeRegExp(searchTerm), options.matchCase ? 'g' : 'gi');
                        cell.textContent = originalContent.replace(regex, replaceTerm);
                    }

                    if (cell.textContent !== originalContent) {
                        replacedCount++;
                    }
                });

                if (options.all) {
                    showStatus(`å·²æ›¿æ¢ ${replacedCount} å¤„å†…å®¹`, 'success');
                } else {
                    showStatus(`å·²æ›¿æ¢å½“å‰é€‰ä¸­å†…å®¹`, 'success');
                }
            }

            escapeRegExp(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }

            showFindResults(results, searchTerm) {
                const resultsDiv = document.getElementById('findResults');
                const contentDiv = document.getElementById('resultsContent');
                
                if (results.length === 0) {
                    contentDiv.innerHTML = 'æœªæ‰¾åˆ°åŒ¹é…å†…å®¹';
                } else {
                    contentDiv.innerHTML = `æ‰¾åˆ° ${results.length} ä¸ªåŒ¹é…é¡¹`;
                }
                
                resultsDiv.style.display = 'block';
            }

            // æ–°å¢ï¼šè‡ªåŠ¨è°ƒæ•´åˆ—å®½
            autoFitColumns() {
                const rows = this.table.querySelectorAll('tr');
                const maxWidths = [];
                
                rows.forEach(row => {
                    Array.from(row.children).forEach((cell, index) => {
                        const width = cell.textContent.length * 8 + 16; // ä¼°ç®—å®½åº¦
                        maxWidths[index] = Math.max(maxWidths[index] || 0, width);
                    });
                });
                
                rows.forEach(row => {
                    Array.from(row.children).forEach((cell, index) => {
                        if (maxWidths[index]) {
                            cell.style.minWidth = maxWidths[index] + 'px';
                        }
                    });
                });
                
                showStatus('å·²è‡ªåŠ¨è°ƒæ•´åˆ—å®½', 'success');
            }

            // æ–°å¢ï¼šå¯¼å‡ºè¡¨æ ¼æ•°æ®
            exportData() {
                const data = [];
                const rows = this.table.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const rowData = [];
                    Array.from(row.children).forEach(cell => {
                        if (cell.tagName === 'TD' && !cell.classList.contains('schedule-day')) {
                            // å¤„ç†åŒ…å«é€—å·ã€å¼•å·æˆ–æ¢è¡Œç¬¦çš„å•å…ƒæ ¼
                            let content = cell.textContent.trim();
                            if (content.includes(',') || content.includes('"') || content.includes('\n') || content.includes('\r')) {
                                content = '"' + content.replace(/"/g, '""') + '"';
                            }
                            rowData.push(content);
                        }
                    });
                    if (rowData.length > 0) {
                        data.push(rowData);
                    }
                });
                
                const csv = data.map(row => row.join(',')).join('\n');
                // æ·»åŠ UTF-8 BOMä»¥è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜
                const bom = '\uFEFF';
                const blob = new Blob([bom + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'schedule.csv';
                link.click();
                
                showStatus('è¡¨æ ¼æ•°æ®å·²å¯¼å‡ºï¼ˆUTF-8ç¼–ç ï¼‰', 'success');
            }

            // æ–°å¢ï¼šå¯¼å…¥è¡¨æ ¼æ•°æ®
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.csv,.txt';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        let csv = event.target.result;
                        
                        // ç§»é™¤UTF-8 BOM
                        if (csv.charCodeAt(0) === 0xFEFF) {
                            csv = csv.slice(1);
                        }
                        
                        // è§£æCSVï¼Œå¤„ç†å¼•å·å’Œè½¬ä¹‰å­—ç¬¦
                        const rows = [];
                        let currentRow = [];
                        let currentCell = '';
                        let inQuotes = false;
                        let i = 0;
                        
                        while (i < csv.length) {
                            const char = csv[i];
                            const nextChar = csv[i + 1];
                            
                            if (inQuotes) {
                                if (char === '"' && nextChar === '"') {
                                    currentCell += '"';
                                    i += 2;
                                } else if (char === '"') {
                                    inQuotes = false;
                                    i++;
                                } else {
                                    currentCell += char;
                                    i++;
                                }
                            } else {
                                if (char === '"') {
                                    inQuotes = true;
                                    i++;
                                } else if (char === ',') {
                                    currentRow.push(currentCell.trim());
                                    currentCell = '';
                                    i++;
                                } else if (char === '\n' || char === '\r') {
                                    if (currentCell || currentRow.length > 0) {
                                        currentRow.push(currentCell.trim());
                                        rows.push(currentRow);
                                        currentRow = [];
                                        currentCell = '';
                                    }
                                    i++;
                                    if (char === '\r' && nextChar === '\n') i++;
                                } else {
                                    currentCell += char;
                                    i++;
                                }
                            }
                        }
                        
                        if (currentCell || currentRow.length > 0) {
                            currentRow.push(currentCell.trim());
                            rows.push(currentRow);
                        }
                        
                        if (rows.length === 0) {
                            showStatus('æœªæ‰¾åˆ°æœ‰æ•ˆæ•°æ®', 'error');
                            return;
                        }
                        
                        this.saveState();
                        
                        // æ¸…ç©ºç°æœ‰å†…å®¹
                        const tbody = this.table.querySelector('tbody');
                        tbody.innerHTML = '';
                        
                        // å¯¼å…¥æ•°æ®
                        rows.forEach((row, rowIndex) => {
                            const newRow = tbody.insertRow();
                            
                            // æ·»åŠ è¡Œæ ‡é¢˜
                            const headerCell = newRow.insertCell();
                            headerCell.textContent = `ç¬¬${rowIndex + 1}èŠ‚`;
                            headerCell.style.fontWeight = 'bold';
                            headerCell.classList.add('schedule-day');
                            
                            // æ·»åŠ æ•°æ®å•å…ƒæ ¼
                            row.forEach(cellData => {
                                const cell = newRow.insertCell();
                                cell.textContent = cellData;
                                cell.classList.add('schedule-cell');
                            });
                        });
                        
                        showStatus(`è¡¨æ ¼æ•°æ®å·²å¯¼å…¥ï¼Œå…±${rows.length}è¡Œ`, 'success');
                    };
                    reader.readAsText(file, 'utf-8'); // æ˜ç¡®æŒ‡å®šUTF-8ç¼–ç 
                };
                
                input.click();
            }

            saveState() {
                this.history = this.history.slice(0, this.historyIndex + 1);
                
                // ä¿å­˜å®Œæ•´çŠ¶æ€ï¼ŒåŒ…æ‹¬è¡¨æ ¼å†…å®¹ã€é€‰ä¸­çŠ¶æ€ã€åˆ—å®½ç­‰
                const state = {
                    html: this.table.innerHTML,
                    selectedCells: this.selectedCells.map(cell => {
                        const row = cell.parentElement;
                        const rows = Array.from(this.table.querySelectorAll('tbody tr'));
                        const rowIndex = rows.indexOf(row);
                        const cells = Array.from(row.children);
                        const cellIndex = cells.indexOf(cell);
                        return { rowIndex, cellIndex };
                    }),
                    copiedData: JSON.parse(JSON.stringify(this.copiedData)), // æ·±æ‹·è´å¤åˆ¶æ•°æ®
                    scrollTop: this.table.parentElement?.scrollTop || 0,
                    scrollLeft: this.table.parentElement?.scrollLeft || 0
                };
                
                this.history.push(state);
                this.historyIndex++;
                
                if (this.history.length > 50) {
                    this.history.shift();
                    this.historyIndex--;
                }
                
                // æ›´æ–°æ’¤é”€/é‡åšæŒ‰é’®çŠ¶æ€
                this.updateUndoRedoButtons();
            }

            undoAction() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    this.restoreState(this.history[this.historyIndex]);
                    showStatus('æ’¤é”€æ“ä½œå®Œæˆ', 'info');
                }
            }

            redoAction() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    this.restoreState(this.history[this.historyIndex]);
                    showStatus('é‡åšæ“ä½œå®Œæˆ', 'info');
                }
            }

            restoreState(state) {
                if (!state) return;
                
                try {
                    // å®Œæˆå½“å‰ç¼–è¾‘
                    this.finishEditing();
                    
                    // æ¢å¤è¡¨æ ¼å†…å®¹
                    this.table.innerHTML = state.html;
                    
                    // æ¢å¤é€‰ä¸­çŠ¶æ€
                    this.clearSelection();
                    if (state.selectedCells && state.selectedCells.length > 0) {
                        const rows = this.table.querySelectorAll('tbody tr');
                        state.selectedCells.forEach(sel => {
                            const row = rows[sel.rowIndex];
                            if (row && row.children[sel.cellIndex]) {
                                const cell = row.children[sel.cellIndex];
                                cell.classList.add('selected');
                                this.selectedCells.push(cell);
                            }
                        });
                    }
                    
                    // æ¢å¤å¤åˆ¶æ•°æ®
                    if (state.copiedData) {
                        this.copiedData = JSON.parse(JSON.stringify(state.copiedData)); // æ·±æ‹·è´
                    }
                    
                    // æ¢å¤æ»šåŠ¨ä½ç½®
                    if (this.table.parentElement) {
                        this.table.parentElement.scrollTop = state.scrollTop || 0;
                        this.table.parentElement.scrollLeft = state.scrollLeft || 0;
                    }
                    
                    // æ›´æ–°æ’¤é”€/é‡åšæŒ‰é’®çŠ¶æ€
                    this.updateUndoRedoButtons();
                    
                } catch (error) {
                    console.error('æ¢å¤çŠ¶æ€å¤±è´¥:', error);
                    showStatus('æ¢å¤çŠ¶æ€å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            }

            reinitializeTable() {
                // é‡æ–°åˆå§‹åŒ–è¡¨æ ¼ï¼Œç¡®ä¿æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨å’Œæ ·å¼æ­£ç¡®
                const cells = this.table.querySelectorAll('td');
                cells.forEach(cell => {
                    if (!cell.classList.contains('schedule-day') && !cell.classList.contains('schedule-cell')) {
                        cell.classList.add('schedule-cell');
                    }
                });
                
                // ç¡®ä¿æ‰€æœ‰å•å…ƒæ ¼éƒ½æœ‰é€‚å½“çš„æ ·å¼
                const headers = this.table.querySelectorAll('th');
                headers.forEach(header => {
                    if (!header.classList.contains('schedule-day')) {
                        header.classList.add('schedule-day');
                    }
                });
                
                // ä¸éœ€è¦é‡æ–°ç»‘å®šäº‹ä»¶ï¼Œäº‹ä»¶å§”æ‰˜å·²ç»å¤„ç†
                // åªéœ€è¦ç¡®ä¿æ ·å¼æ­£ç¡®
            }

            setupTableEvents() {
                // é‡æ–°è®¾ç½®è¡¨æ ¼äº‹ä»¶ï¼Œç¡®ä¿æ’¤é”€/é‡åšåçš„äº¤äº’æ­£å¸¸
                const cells = this.table.querySelectorAll('td');
                cells.forEach(cell => {
                    cell.addEventListener('mousedown', (e) => this.handleMouseDown(e));
                    cell.addEventListener('mouseover', (e) => this.handleMouseOver(e));
                    cell.addEventListener('mouseup', (e) => this.handleMouseUp(e));
                    cell.addEventListener('dblclick', (e) => {
                        if (cell.tagName !== 'TH' && !cell.classList.contains('schedule-day')) {
                            this.startEditing(cell);
                        }
                    });
                });
            }

            selectRow() {
                if (this.selectedCells.length === 0) return;
                
                const firstCell = this.selectedCells[0];
                const row = firstCell.parentElement;
                const cells = Array.from(row.children).filter(cell => 
                    cell.tagName !== 'TH' && !cell.classList.contains('schedule-day')
                );
                
                this.clearSelection();
                cells.forEach(cell => {
                    cell.classList.add('selected');
                    this.selectedCells.push(cell);
                });
            }

            selectColumn() {
                if (this.selectedCells.length === 0) return;
                
                const firstCell = this.selectedCells[0];
                const columnIndex = Array.from(firstCell.parentElement.children).indexOf(firstCell);
                const rows = this.table.querySelectorAll('tbody tr');
                
                this.clearSelection();
                rows.forEach(row => {
                    const cell = row.children[columnIndex];
                    if (cell && cell.tagName !== 'TH' && !cell.classList.contains('schedule-day')) {
                        cell.classList.add('selected');
                        this.selectedCells.push(cell);
                    }
                });
            }

            showFluentDialog(options) {
                return new Promise((resolve) => {
                    const dialog = document.createElement('div');
                    dialog.className = 'fluent-dialog-overlay';
                    dialog.innerHTML = `
                        <div class="fluent-dialog">
                            <div class="fluent-dialog-header">
                                <div class="fluent-dialog-icon ${options.type || 'info'}">
                                    ${options.type === 'danger' ? 'âš ï¸' : options.type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}
                                </div>
                                <h3 class="fluent-dialog-title">${options.title || 'ç¡®è®¤æ“ä½œ'}</h3>
                                <button class="fluent-dialog-close" onclick="this.closest('.fluent-dialog-overlay').remove()">Ã—</button>
                            </div>
                            <div class="fluent-dialog-content">
                                <p class="fluent-dialog-message">${options.message || 'ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ'}</p>
                            </div>
                            <div class="fluent-dialog-footer">
                                <button class="fluent-button fluent-button-secondary">${options.cancelText || 'å–æ¶ˆ'}</button>
                                <button class="fluent-button ${options.type === 'danger' ? 'fluent-button-danger' : 'fluent-button-primary'}">${options.confirmText || 'ç¡®å®š'}</button>
                            </div>
                        </div>
                    `;
                    
                    // æ·»åŠ æ ·å¼
                    if (!document.querySelector('#fluent-dialog-styles')) {
                        const style = document.createElement('style');
                        style.id = 'fluent-dialog-styles';
                        style.textContent = `
                            .fluent-dialog-overlay {
                                position: fixed;
                                top: 0;
                                left: 0;
                                width: 100%;
                                height: 100%;
                                background: rgba(0, 0, 0, 0.32);
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                z-index: 10000;
                                backdrop-filter: blur(8px);
                                animation: fadeIn 0.15s ease-out;
                            }
                            
                            .fluent-dialog {
                                background: var(--card-bg);
                                border-radius: 12px;
                                box-shadow: 0 32px 64px rgba(0, 0, 0, 0.24), 0 0 0 1px rgba(255, 255, 255, 0.08);
                                min-width: 400px;
                                max-width: 520px;
                                margin: 20px;
                                animation: slideUp 0.2s ease-out;
                                border: 1px solid rgba(255, 255, 255, 0.1);
                                overflow: hidden;
                            }
                            
                            .fluent-dialog-header {
                                display: flex;
                                align-items: center;
                                padding: 20px 24px 0;
                                gap: 12px;
                            }
                            
                            .fluent-dialog-icon {
                                font-size: 20px;
                                width: 24px;
                                height: 24px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                flex-shrink: 0;
                            }
                            
                            .fluent-dialog-title {
                                font-size: 20px;
                                font-weight: 600;
                                margin: 0;
                                color: var(--text-color);
                                flex: 1;
                            }
                            
                            .fluent-dialog-close {
                                background: none;
                                border: none;
                                font-size: 20px;
                                cursor: pointer;
                                color: var(--text-color-secondary);
                                padding: 0;
                                width: 32px;
                                height: 32px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                border-radius: 4px;
                                transition: all 0.15s ease;
                            }
                            
                            .fluent-dialog-close:hover {
                                background: var(--hover-color);
                                color: var(--text-color);
                            }
                            
                            .fluent-dialog-content {
                                padding: 8px 24px 24px;
                            }
                            
                            .fluent-dialog-message {
                                font-size: 15px;
                                color: var(--text-color-secondary);
                                line-height: 1.5;
                                margin: 0;
                            }
                            
                            .fluent-dialog-footer {
                                display: flex;
                                gap: 12px;
                                justify-content: flex-end;
                                padding: 0 24px 20px;
                            }
                            
                            .fluent-button {
                                padding: 8px 16px;
                                border: 1px solid var(--border-color);
                                border-radius: 6px;
                                background: var(--card-bg);
                                color: var(--text-color);
                                font-size: 14px;
                                font-weight: 500;
                                cursor: pointer;
                                transition: all 0.15s ease;
                                font-family: inherit;
                                min-width: 80px;
                                height: 36px;
                                display: inline-flex;
                                align-items: center;
                                justify-content: center;
                            }
                            
                            .fluent-button:hover {
                                background: var(--hover-color);
                                border-color: var(--border-color-hover);
                            }
                            
                            .fluent-button:active {
                                transform: scale(0.98);
                            }
                            
                            .fluent-button-primary {
                                background: var(--primary-color);
                                color: white;
                                border-color: var(--primary-color);
                                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
                            }
                            
                            .fluent-button-primary:hover {
                                background: var(--secondary-color);
                                border-color: var(--secondary-color);
                                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
                            }
                            
                            .fluent-button-danger {
                                background: var(--danger-color);
                                color: white;
                                border-color: var(--danger-color);
                                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
                            }
                            
                            .fluent-button-danger:hover {
                                background: #a4262c;
                                border-color: #a4262c;
                                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
                            }
                            
                            @keyframes fadeIn {
                                from { opacity: 0; }
                                to { opacity: 1; }
                            }
                            
                            @keyframes slideUp {
                                from {
                                    opacity: 0;
                                    transform: translateY(10px) scale(0.98);
                                }
                                to {
                                    opacity: 1;
                                    transform: translateY(0) scale(1);
                                }
                            }
                            
                            @media (max-width: 600px) {
                                .fluent-dialog {
                                    min-width: 280px;
                                    margin: 16px;
                                }
                                
                                .fluent-dialog-header {
                                    padding: 16px 20px 0;
                                }
                                
                                .fluent-dialog-content {
                                    padding: 8px 20px 20px;
                                }
                                
                                .fluent-dialog-footer {
                                    padding: 0 20px 16px;
                                }
                            }
                        `;
                        document.head.appendChild(style);
                    }
                    
                    document.body.appendChild(dialog);
                    
                    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
                    const cancelBtn = dialog.querySelector('.fluent-button-secondary');
                    const confirmBtn = dialog.querySelector('.fluent-button-primary, .fluent-button-danger');
                    
                    cancelBtn.onclick = () => {
                        dialog.remove();
                        resolve(false);
                    };
                    
                    confirmBtn.onclick = () => {
                        dialog.remove();
                        resolve(true);
                    };
                    
                    // ç‚¹å‡»èƒŒæ™¯å…³é—­
                    dialog.onclick = (e) => {
                        if (e.target === dialog) {
                            dialog.remove();
                            resolve(false);
                        }
                    };
                });
            }

            async deleteRow() {
                if (this.selectedCells.length === 0) {
                    await this.showFluentDialog({
                        title: 'æç¤º',
                        message: 'è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è¡Œ',
                        confirmText: 'ç¡®å®š',
                        type: 'info'
                    });
                    return;
                }
                
                const rowsToDelete = new Set();
                
                this.selectedCells.forEach(cell => {
                    const row = cell.parentElement;
                    if (row.rowIndex > 0) { // è·³è¿‡æ ‡é¢˜è¡Œ
                        rowsToDelete.add(row);
                    }
                });
                
                if (rowsToDelete.size === 0) {
                    await this.showFluentDialog({
                        title: 'æç¤º',
                        message: 'è¯·é€‰æ‹©æœ‰æ•ˆçš„è¡Œ',
                        confirmText: 'ç¡®å®š',
                        type: 'info'
                    });
                    return;
                }
                
                const confirmed = await this.showFluentDialog({
                    title: 'ç¡®è®¤åˆ é™¤',
                    message: `ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${rowsToDelete.size} è¡Œå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`,
                    confirmText: 'åˆ é™¤',
                    cancelText: 'å–æ¶ˆ',
                    type: 'danger'
                });
                
                if (confirmed) {
                    this.saveState();
                    rowsToDelete.forEach(row => row.remove());
                    this.clearSelection();
                }
            }

            async deleteColumn() {
                if (this.selectedCells.length === 0) {
                    await this.showFluentDialog({
                        title: 'æç¤º',
                        message: 'è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„åˆ—',
                        confirmText: 'ç¡®å®š',
                        type: 'info'
                    });
                    return;
                }
                
                const columnsToDelete = new Set();
                
                this.selectedCells.forEach(cell => {
                    const columnIndex = Array.from(cell.parentElement.children).indexOf(cell);
                    columnsToDelete.add(columnIndex);
                });
                
                const columnCount = this.table.rows[0].cells.length;
                const validColumns = Array.from(columnsToDelete).filter(index => index > 0);
                
                if (validColumns.length === 0) {
                    await this.showFluentDialog({
                        title: 'æç¤º',
                        message: 'è¯·é€‰æ‹©æœ‰æ•ˆçš„åˆ—',
                        confirmText: 'ç¡®å®š',
                        type: 'info'
                    });
                    return;
                }
                
                const confirmed = await this.showFluentDialog({
                    title: 'ç¡®è®¤åˆ é™¤',
                    message: `ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${validColumns.length} åˆ—å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`,
                    confirmText: 'åˆ é™¤',
                    cancelText: 'å–æ¶ˆ',
                    type: 'danger'
                });
                
                if (confirmed) {
                    this.saveState();
                    
                    // ä»å³åˆ°å·¦åˆ é™¤åˆ—ï¼Œé¿å…ç´¢å¼•é—®é¢˜
                    validColumns.sort((a, b) => b - a);
                    validColumns.forEach(index => {
                        Array.from(this.table.rows).forEach(row => {
                            if (row.cells[index]) {
                                row.deleteCell(index);
                            }
                        });
                    });
                    
                    this.clearSelection();
                }
            }

            createContextMenu() {
                // å³é”®èœå• - Fluent Design with submenus
                const contextMenu = document.createElement('div');
                contextMenu.id = 'contextMenu';
                contextMenu.className = 'context-menu';
                contextMenu.innerHTML = `
                    <div class="context-menu-item" onclick="tableEditor.copyCells(); tableEditor.hideContextMenu();">
                        <span class="menu-icon">ğŸ“‹</span>
                        <span>å¤åˆ¶</span>
                        <span class="menu-shortcut">Ctrl+C</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.pasteCells(); tableEditor.hideContextMenu();">
                        <span class="menu-icon">ğŸ“„</span>
                        <span>ç²˜è´´</span>
                        <span class="menu-shortcut">Ctrl+V</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.clearCells(); tableEditor.hideContextMenu();">
                        <span class="menu-icon">ğŸ—‘ï¸</span>
                        <span>æ¸…ç©ºå†…å®¹</span>
                        <span class="menu-shortcut">Delete</span>
                    </div>
                    
                    <div class="context-menu-separator"></div>
                    
                    <div class="context-menu-item" onclick="tableEditor.mergeCells(); tableEditor.hideContextMenu();">
                        <span class="menu-icon">ğŸ”²</span>
                        <span>åˆå¹¶å†…å®¹</span>
                        <span class="menu-shortcut">Ctrl+M</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.splitCell(); tableEditor.hideContextMenu();">
                        <span class="menu-icon">ğŸ”³</span>
                        <span>æ‹†åˆ†å†…å®¹</span>
                        <span class="menu-shortcut">Ctrl+Shift+M</span>
                    </div>
                    
                    <div class="context-menu-separator"></div>
                    
                    <div class="context-menu-item" onclick="tableEditor.addRow(); tableEditor.hideContextMenu();">
                        <span class="menu-icon">â•</span>
                        <span>æ·»åŠ è¡Œ</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.addColumn(); tableEditor.hideContextMenu();">
                        <span class="menu-icon">â•</span>
                        <span>æ·»åŠ åˆ—</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.deleteRow(); tableEditor.hideContextMenu();">
                        <span class="menu-icon">â–</span>
                        <span>åˆ é™¤è¡Œ</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.deleteColumn(); tableEditor.hideContextMenu();">
                        <span class="menu-icon">â–</span>
                        <span>åˆ é™¤åˆ—</span>
                    </div>
                    
                    <div class="context-menu-separator"></div>
                    
                    <div class="context-menu-item" onclick="tableEditor.undoAction(); tableEditor.hideContextMenu();" id="contextUndo">
                        <span class="menu-icon">â†¶</span>
                        <span>æ’¤é”€</span>
                        <span class="menu-shortcut">Ctrl+Z</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.redoAction(); tableEditor.hideContextMenu();" id="contextRedo">
                        <span class="menu-icon">â†·</span>
                        <span>é‡åš</span>
                        <span class="menu-shortcut">Ctrl+Shift+Z</span>
                    </div>
                `;
                document.body.appendChild(contextMenu);

                // é•¿æŒ‰èœå•ï¼ˆè§¦å±ï¼‰- ç®€åŒ–ç‰ˆæœ¬
                const longPressMenu = document.createElement('div');
                longPressMenu.id = 'longPressMenu';
                longPressMenu.className = 'long-press-menu';
                longPressMenu.innerHTML = `
                    <div class="context-menu-item" onclick="tableEditor.addRow()">
                        <span class="menu-icon">â•</span>
                        <span>æ·»åŠ è¡Œ</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.addColumn()">
                        <span class="menu-icon">â•</span>
                        <span>æ·»åŠ åˆ—</span>
                    </div>
                    <div class="context-menu-separator"></div>
                    <div class="context-menu-item" onclick="tableEditor.selectRow()">
                        <span class="menu-icon">ğŸ“‹</span>
                        <span>é€‰æ‹©æ•´è¡Œ</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.selectColumn()">
                        <span class="menu-icon">ğŸ“‹</span>
                        <span>é€‰æ‹©æ•´åˆ—</span>
                    </div>
                    <div class="context-menu-separator"></div>
                    <div class="context-menu-item" onclick="tableEditor.deleteRow()">
                        <span class="menu-icon">ğŸ—‘ï¸</span>
                        <span>åˆ é™¤è¡Œ</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.deleteColumn()">
                        <span class="menu-icon">ğŸ—‘ï¸</span>
                        <span>åˆ é™¤åˆ—</span>
                    </div>
                    <div class="context-menu-separator"></div>
                    <div class="context-menu-item" onclick="tableEditor.mergeCells()">
                        <span class="menu-icon">ğŸ”²</span>
                        <span>åˆå¹¶å•å…ƒæ ¼</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.splitCell()">
                        <span class="menu-icon">ğŸ”³</span>
                        <span>æ‹†åˆ†å•å…ƒæ ¼</span>
                    </div>
                    <div class="context-menu-separator"></div>
                    <div class="context-menu-item" onclick="tableEditor.fillSeries()">
                        <span class="menu-icon">ğŸ“Š</span>
                        <span>å¡«å……åºåˆ—</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.autoFitColumns()">
                        <span class="menu-icon">ğŸ“</span>
                        <span>è‡ªåŠ¨åˆ—å®½</span>
                    </div>
                    <div class="context-menu-separator"></div>
                    <div class="context-menu-item" onclick="tableEditor.exportData()">
                        <span class="menu-icon">ğŸ“¤</span>
                        <span>å¯¼å‡ºCSV</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.importData()">
                        <span class="menu-icon">ğŸ“¥</span>
                        <span>å¯¼å…¥CSV</span>
                    </div>
                    <div class="context-menu-separator"></div>
                    <div class="context-menu-item" onclick="tableEditor.clearCells()">
                        <span class="menu-icon">ğŸ§¹</span>
                        <span>æ¸…ç©º</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.undoAction()">
                        <span class="menu-icon">â†¶</span>
                        <span>æ’¤é”€</span>
                    </div>
                    <div class="context-menu-item" onclick="tableEditor.redoAction()">
                        <span class="menu-icon">â†·</span>
                        <span>é‡åš</span>
                    </div>`;
                document.body.appendChild(longPressMenu);
            }

            showContextMenu(e, cell) {
                const menu = document.getElementById('contextMenu');
                if (!menu) {
                    console.error('Context menu not found');
                    return;
                }
                
                // å…ˆéšè—èœå•
                menu.style.display = 'none';
                menu.classList.remove('flipped-x', 'flipped-y', 'show');
                
                // æ¸…é™¤ä¹‹å‰çš„æ´»åŠ¨çŠ¶æ€
                menu.querySelectorAll('.context-menu-item.active').forEach(item => {
                    item.classList.remove('active');
                });
                
                // æ›´æ–°æ’¤é”€/é‡åšèœå•é¡¹çŠ¶æ€
                const status = this.getUndoRedoStatus();
                const contextUndo = document.getElementById('contextUndo');
                const contextRedo = document.getElementById('contextRedo');
                const contextClearHistory = document.getElementById('contextClearHistory');
                
                if (contextUndo) {
                    contextUndo.style.opacity = status.canUndo ? '1' : '0.5';
                    contextUndo.style.pointerEvents = status.canUndo ? 'auto' : 'none';
                    contextUndo.title = status.canUndo ? 
                        `æ’¤é”€ (${status.undoCount}/${status.maxHistory})` : 
                        'æ— æ“ä½œå¯æ’¤é”€';
                }
                
                if (contextRedo) {
                    contextRedo.style.opacity = status.canRedo ? '1' : '0.5';
                    contextRedo.style.pointerEvents = status.canRedo ? 'auto' : 'none';
                    contextRedo.title = status.canRedo ? 
                        `é‡åš (${status.redoCount}/${status.maxHistory})` : 
                        'æ— æ“ä½œå¯é‡åš';
                }
                
                if (contextClearHistory) {
                    contextClearHistory.style.opacity = !status.isEmpty ? '1' : '0.5';
                    contextClearHistory.style.pointerEvents = !status.isEmpty ? 'auto' : 'none';
                    contextClearHistory.title = !status.isEmpty ? 
                        `æ¸…é™¤æ‰€æœ‰å†å²è®°å½• (${status.totalStates} ä¸ªçŠ¶æ€)` : 
                        'å†å²è®°å½•ä¸ºç©º';
                }
                
                // ä¸´æ—¶æ˜¾ç¤ºä»¥è·å–å°ºå¯¸
                menu.style.position = 'fixed';
                menu.style.left = '-9999px';
                menu.style.top = '-9999px';
                menu.style.display = 'block';
                menu.style.visibility = 'hidden';
                
                // è·å–å®é™…å°ºå¯¸
                const menuRect = menu.getBoundingClientRect();
                
                // è®¡ç®—ä½ç½®
                let left = e.clientX;
                let top = e.clientY;
                
                // è¾¹ç•Œæ£€æµ‹
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                // æ£€æµ‹æ˜¯å¦éœ€è¦æ°´å¹³ç¿»è½¬
                if (left + menuRect.width > viewportWidth - 10) {
                    left = left - menuRect.width;
                    menu.classList.add('flipped-x');
                }
                
                // æ£€æµ‹æ˜¯å¦éœ€è¦å‚ç›´ç¿»è½¬
                if (top + menuRect.height > viewportHeight - 10) {
                    top = top - menuRect.height;
                    menu.classList.add('flipped-y');
                }
                
                // ç¡®ä¿ä¸è¶…å‡ºè¾¹ç•Œ
                left = Math.max(10, Math.min(left, viewportWidth - menuRect.width - 10));
                top = Math.max(10, Math.min(top, viewportHeight - menuRect.height - 10));
                
                // è®¾ç½®æœ€ç»ˆä½ç½®å¹¶æ˜¾ç¤º
                menu.style.left = left + 'px';
                menu.style.top = top + 'px';
                menu.style.visibility = 'visible';
                menu.classList.add('show');
                
                // é˜»æ­¢äº‹ä»¶å†’æ³¡
                e.preventDefault();
                e.stopPropagation();
                
                // è®°å½•å³é”®ç‚¹å‡»çš„å•å…ƒæ ¼
                this.lastRightClickedCell = cell;
            }

            // éšè—ä¸Šä¸‹æ–‡èœå•
            hideContextMenu() {
                const contextMenu = document.getElementById('contextMenu');
                const longPressMenu = document.getElementById('longPressMenu');
                
                if (contextMenu) {
                    contextMenu.style.display = 'none';
                    contextMenu.classList.remove('show');
                }
                if (longPressMenu) {
                    longPressMenu.style.display = 'none';
                    longPressMenu.classList.remove('show');
                }
                
                // æ¸…é™¤æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.context-menu-item.active').forEach(item => {
                    item.classList.remove('active');
                });
            }

           
            showLongPressMenu(e, cell) {
                const menu = document.getElementById('longPressMenu');
                
                // é‡ç½®æ ·å¼ç±»
                menu.classList.remove('flipped-x', 'flipped-y');
                
                // æ›´æ–°æ’¤é”€/é‡åšèœå•é¡¹çŠ¶æ€
                const status = this.getUndoRedoStatus();
                const longPressUndo = menu.querySelector('[onclick="tableEditor.undoAction()"]');
                const longPressRedo = menu.querySelector('[onclick="tableEditor.redoAction()"]');
                
                if (longPressUndo) {
                    longPressUndo.style.opacity = status.canUndo ? '1' : '0.5';
                    longPressUndo.style.pointerEvents = status.canUndo ? 'auto' : 'none';
                    longPressUndo.title = status.canUndo ? 
                        `æ’¤é”€ (${status.undoCount}/${status.maxHistory})` : 
                        'æ— æ“ä½œå¯æ’¤é”€';
                }
                
                if (longPressRedo) {
                    longPressRedo.style.opacity = status.canRedo ? '1' : '0.5';
                    longPressRedo.style.pointerEvents = status.canRedo ? 'auto' : 'none';
                    longPressRedo.title = status.canRedo ? 
                        `é‡åš (${status.redoCount}/${status.maxHistory})` : 
                        'æ— æ“ä½œå¯é‡åš';
                }
                
                // å…ˆä¸´æ—¶æ˜¾ç¤ºä»¥è·å–å®é™…å°ºå¯¸
                menu.style.display = 'block';
                menu.style.position = 'fixed';
                menu.style.left = '-9999px';
                menu.style.top = '-9999px';
                
                // è·å–å®é™…å°ºå¯¸
                const menuRect = menu.getBoundingClientRect();
                
                // è®¡ç®—ä½ç½®ï¼Œç¡®ä¿èœå•å·¦ä¸Šè§’ç²¾ç¡®å¯¹å‡†è§¦æ‘¸ç‚¹
                let left = e.touches[0].clientX;
                let top = e.touches[0].clientY;
                
                // è¾¹ç•Œæ£€æµ‹
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                // æ£€æµ‹æ˜¯å¦éœ€è¦æ°´å¹³ç¿»è½¬
                const needsFlipX = left + menuRect.width > viewportWidth;
                if (needsFlipX) {
                    left = left - menuRect.width;
                    menu.classList.add('flipped-x');
                }
                
                // æ£€æµ‹æ˜¯å¦éœ€è¦å‚ç›´ç¿»è½¬
                const needsFlipY = top + menuRect.height > viewportHeight;
                if (needsFlipY) {
                    top = top - menuRect.height;
                    menu.classList.add('flipped-y');
                }
                
                // ç¡®ä¿ä¸è¶…å‡ºè¾¹ç•Œ
                left = Math.max(8, Math.min(left, viewportWidth - menuRect.width - 8));
                top = Math.max(8, Math.min(top, viewportHeight - menuRect.height - 8));
                
                // è®¾ç½®æœ€ç»ˆä½ç½®å¹¶æ˜¾ç¤º
                menu.style.left = left + 'px';
                menu.style.top = top + 'px';
                
                // é˜»æ­¢äº‹ä»¶å†’æ³¡
                e.preventDefault();
                e.stopPropagation();
                
                // ç§»é™¤æ—§çš„å…³é—­ç›‘å¬å™¨ï¼Œè®©setupMenuEventsä¸­çš„å…¨å±€ç›‘å¬å™¨å¤„ç†
            }

            updateUndoRedoButtons() {
                // æ›´æ–°æ’¤é”€/é‡åšæŒ‰é’®çŠ¶æ€
                const undoBtn = document.querySelector('[onclick*="undoAction"]');
                const redoBtn = document.querySelector('[onclick*="redoAction"]');
                
                if (undoBtn) {
                    undoBtn.disabled = this.historyIndex <= 0;
                }
                if (redoBtn) {
                    redoBtn.disabled = this.historyIndex >= this.history.length - 1;
                }
                
                // ä¹Ÿæ›´æ–°å…¨å±€çš„æ’¤é”€/é‡åšæŒ‰é’®
                if (typeof updateUndoRedoButtons === 'function') {
                    updateUndoRedoButtons();
                }
            }
        }

        // åˆå§‹åŒ–è¡¨æ ¼ç¼–è¾‘å™¨
            let tableEditor;
            document.addEventListener('DOMContentLoaded', () => {
                tableEditor = new OfficeTableEditor('scheduleTable');
                
                // è®¾ç½®èœå•äº‹ä»¶
                setupMenuEvents();
                
                // åˆå§‹åŒ–æ’¤é”€/é‡åšæŒ‰é’®çŠ¶æ€
                updateUndoRedoButtons();
                
                // æ·»åŠ å…¨å±€é”®ç›˜å¿«æ·é”®æ”¯æŒ
                document.addEventListener('keydown', (e) => {
                    // Ctrl+Z æ’¤é”€
                    if (e.ctrlKey && e.key === 'z' && !e.shiftKey) {
                        e.preventDefault();
                        if (tableEditor) {
                            tableEditor.undoAction();
                        }
                    }
                    
                    // Ctrl+Shift+Z æˆ– Ctrl+Y é‡åš
                    if ((e.ctrlKey && e.shiftKey && e.key === 'Z') || (e.ctrlKey && e.key === 'y')) {
                        e.preventDefault();
                        if (tableEditor) {
                            tableEditor.redoAction();
                        }
                    }
                });
            });
            
            // æ›´æ–°æ’¤é”€/é‡åšæŒ‰é’®çŠ¶æ€
            function updateUndoRedoButtons() {
                const undoBtn = document.querySelector('button[onclick="undoAction()"]');
                const redoBtn = document.querySelector('button[onclick="redoAction()"]');
                
                if (undoBtn && redoBtn && tableEditor) {
                    const status = tableEditor.getUndoRedoStatus();
                    
                    // æ›´æ–°æ’¤é”€æŒ‰é’®
                    undoBtn.disabled = !status.canUndo;
                    undoBtn.title = status.canUndo ? 
                        `æ’¤é”€ (${status.undoCount}/${status.maxHistory}) Ctrl+Z` : 
                        'æ— æ“ä½œå¯æ’¤é”€';
                    
                    // æ›´æ–°é‡åšæŒ‰é’®
                    redoBtn.disabled = !status.canRedo;
                    redoBtn.title = status.canRedo ? 
                        `é‡åš (${status.redoCount}/${status.maxHistory}) Ctrl+Shift+Z` : 
                        'æ— æ“ä½œå¯é‡åš';
                    
                    // æ·»åŠ è§†è§‰åé¦ˆ
                    undoBtn.style.opacity = status.canUndo ? '1' : '0.5';
                    redoBtn.style.opacity = status.canRedo ? '1' : '0.5';
                }
            }
            
            // è®¾ç½®èœå•äº‹ä»¶å¤„ç†
            function setupMenuEvents() {
                // åªä¸ºæœ‰å­èœå•çš„contextMenuè®¾ç½®äº‹ä»¶
                const contextMenu = document.getElementById('contextMenu');
                if (contextMenu) {
                    // ä½¿ç”¨äº‹ä»¶å§”æ‰˜æ¥å¤„ç†å­èœå•ç‚¹å‡»
                    contextMenu.addEventListener('click', function(e) {
                        const item = e.target.closest('.context-menu-item');
                        if (!item) return;
                        
                        const submenu = item.querySelector('.submenu');
                        if (submenu) {
                            // ç¡®ä¿ç‚¹å‡»çš„æ˜¯æœ‰å­èœå•çš„é¡¹
                            e.stopPropagation();
                            e.preventDefault();
                            
                            // åˆ‡æ¢æ´»åŠ¨çŠ¶æ€
                            const isActive = item.classList.contains('active');
                            
                            // å…³é—­åŒä¸€èœå•ä¸­çš„å…¶ä»–å­èœå•
                            contextMenu.querySelectorAll('.context-menu-item').forEach(mi => {
                                mi.classList.remove('active');
                            });
                            
                            // å¦‚æœä¹‹å‰ä¸æ˜¯æ´»åŠ¨çŠ¶æ€ï¼Œåˆ™æ¿€æ´»
                            if (!isActive) {
                                item.classList.add('active');
                            }
                        }
                    });
                    
                    // é˜»æ­¢å­èœå•é¡¹çš„ç‚¹å‡»äº‹ä»¶å†’æ³¡åˆ°çˆ¶èœå•
                    contextMenu.addEventListener('click', function(e) {
                        const submenuItem = e.target.closest('.submenu .context-menu-item');
                        if (submenuItem) {
                            e.stopPropagation();
                        }
                    });
                }
                
                // ç‚¹å‡»å¤–éƒ¨å…³é—­æ‰€æœ‰å­èœå•å’Œèœå•
                document.addEventListener('click', function(e) {
                    const isClickInsideMenu = e.target.closest('.context-menu') || e.target.closest('.long-press-menu');
                    if (!isClickInsideMenu) {
                        document.querySelectorAll('.context-menu-item.active').forEach(item => {
                            item.classList.remove('active');
                        });
                        
                        // å…³é—­æ‰€æœ‰èœå•
                        const contextMenu = document.getElementById('contextMenu');
                        const longPressMenu = document.getElementById('longPressMenu');
                        if (contextMenu) {
                            contextMenu.style.display = 'none';
                            contextMenu.classList.remove('show');
                        }
                        if (longPressMenu) {
                            longPressMenu.style.display = 'none';
                            longPressMenu.classList.remove('show');
                        }
                    }
                });
                
                // ESCé”®å…³é—­èœå•
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        const contextMenu = document.getElementById('contextMenu');
                        const longPressMenu = document.getElementById('longPressMenu');
                        if (contextMenu) {
                            contextMenu.style.display = 'none';
                            contextMenu.classList.remove('show');
                        }
                        if (longPressMenu) {
                            longPressMenu.style.display = 'none';
                            longPressMenu.classList.remove('show');
                        }
                    }
                });

                // å­èœå•æ‚¬åœäº‹ä»¶ - ä¿®å¤å­èœå•å±•å¼€é—®é¢˜
                document.querySelectorAll('.context-menu-item.has-submenu').forEach(item => {
                    let hoverTimeout;
                    
                    item.addEventListener('mouseenter', function() {
                        clearTimeout(hoverTimeout);
                        
                        // å…³é—­å…¶ä»–å­èœå•
                        document.querySelectorAll('.context-menu-item.active').forEach(activeItem => {
                            if (activeItem !== this) {
                                activeItem.classList.remove('active');
                            }
                        });
                        
                        // æ¿€æ´»å½“å‰å­èœå•
                        this.classList.add('active');
                        
                        // ç¡®ä¿å­èœå•æ˜¾ç¤º
                        const submenu = this.querySelector('.submenu');
                        if (submenu) {
                            submenu.style.display = 'block';
                        }
                    });
                    
                    item.addEventListener('mouseleave', function(e) {
                        const self = this;
                        hoverTimeout = setTimeout(() => {
                            // æ£€æŸ¥é¼ æ ‡æ˜¯å¦åœ¨å­èœå•å†…
                            const submenu = self.querySelector('.submenu');
                            if (submenu) {
                                const rect = submenu.getBoundingClientRect();
                                const isInSubmenu = e.clientX >= rect.left && e.clientX <= rect.right && 
                                                  e.clientY >= rect.top && e.clientY <= rect.bottom;
                                
                                if (!isInSubmenu) {
                                    self.classList.remove('active');
                                    submenu.style.display = 'none';
                                }
                            }
                        }, 100);
                    });
                    
                    // å­èœå•å†…çš„é¼ æ ‡äº‹ä»¶
                    const submenu = item.querySelector('.submenu');
                    if (submenu) {
                        submenu.addEventListener('mouseenter', function() {
                            clearTimeout(hoverTimeout);
                            item.classList.add('active');
                        });
                        
                        submenu.addEventListener('mouseleave', function() {
                            hoverTimeout = setTimeout(() => {
                                item.classList.remove('active');
                                this.style.display = 'none';
                            }, 100);
                        });
                    }
                });
                
                // é˜»æ­¢å³é”®èœå•çš„é»˜è®¤è¡Œä¸º
                document.addEventListener('contextmenu', function(e) {
                    if (e.target.closest('.context-menu') || e.target.closest('.long-press-menu')) {
                        e.preventDefault();
                    }
                });
            }

        // å·¥å…·æ æŒ‰é’®å‡½æ•°
        function addRow() { tableEditor.addRow(); }
        function addColumn() { tableEditor.addColumn(); }
        function deleteSelected() { tableEditor.deleteSelected(); }
        function copyCells() { tableEditor.copyCells(); }
        function pasteCells() { tableEditor.pasteCells(); }
        function mergeCells() { tableEditor.mergeCells(); }
        function splitCell() { tableEditor.splitCell(); }
        function clearCells() { tableEditor.clearCells(); }
        function undoAction() { tableEditor.undoAction(); }
        function redoAction() { tableEditor.redoAction(); }
        function deleteRow() { tableEditor.deleteRow(); }
        function deleteColumn() { tableEditor.deleteColumn(); }
        function fillSeries() { tableEditor.fillSeries(); }
        function findAndReplace() { tableEditor.findAndReplace(); }
        function autoFitColumns() { tableEditor.autoFitColumns(); }
        function exportData() { tableEditor.exportData(); }
        function importData() { tableEditor.importData(); }
        
        // å³é”®èœå•å‡½æ•°
        function editCell() { 
            if (tableEditor.selectedCells && tableEditor.selectedCells.length > 0) {
                tableEditor.startEditing(tableEditor.selectedCells[0]); 
            }
        }
        function copyCell() { tableEditor.copyCells(); }
        function pasteCell() { tableEditor.pasteCells(); }
        function deleteCell() { tableEditor.deleteSelected(); }
        function clearCell() { tableEditor.clearCells(); }
        function mergeRight() { tableEditor.mergeCells(); }
        function mergeDown() { tableEditor.mergeCells(); }
        function selectRow() { tableEditor.selectRow(); }
        function selectColumn() { tableEditor.selectColumn(); }
        
        // è§¦å±é•¿æŒ‰èœå•å‡½æ•°
        function editCellTouch() { 
            if (tableEditor.selectedCells && tableEditor.selectedCells.length > 0) {
                tableEditor.startEditing(tableEditor.selectedCells[0]); 
            }
        }
        function copyCellTouch() { tableEditor.copyCells(); }
        function pasteCellTouch() { tableEditor.pasteCells(); }
        function deleteCellTouch() { tableEditor.deleteSelected(); }
        function clearCellTouch() { tableEditor.clearCells(); }
    </script>
    <div id="status" class="status"></div>
</body>

</html>